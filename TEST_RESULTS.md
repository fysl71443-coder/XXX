# ูุชุงุฆุฌ ุงูุงุฎุชุจุงุฑ ุงูุดุงูู - ุญุณุงุจ ุงูููู ุงูุชููุงุฆูุฉ ูููุณูุฏุงุช

## ุญุงูุฉ ุงูุฎุงุฏู

โ **ุงูุฎุงุฏู ุบูุฑ ูุนูู ุญุงููุงู**

### ุฑุงุจุท ุงูุฎุงุฏู ุงููุญูู:
- **URL:** `http://localhost:10000`
- **API Base:** `http://localhost:10000/api`
- **Health Check:** `http://localhost:10000/health`

### ูุชุดุบูู ุงูุฎุงุฏู:

```bash
cd backend
npm start
```

ุงูุฎุงุฏู ุณูุจุฏุฃ ุนูู ุงููููุฐ `10000` (ุฃู ุงููููุฐ ุงููุญุฏุฏ ูู `process.env.PORT`).

---

## ุงูุงุฎุชุจุงุฑุงุช ุงููุชุงุญุฉ

### 1. ุงูุงุฎุชุจุงุฑ ุงูุขูู ุงูุดุงูู

**ุงูููู:** `test_draft_calculations.js`

**ุงูุชุดุบูู:**
```bash
node test_draft_calculations.js
```

**ูุฎุชุจุฑ:**
- โ ุชุณุฌูู ุงูุฏุฎูู
- โ ุฅูุดุงุก ูุณูุฏุฉ ุฌุฏูุฏุฉ ูุน ุญุณุงุจ `subtotal`, `discount_amount`, `tax_amount`, `total_amount`
- โ ุญูุธ ูุณูุฏุฉ ูู POS (`/api/pos/saveDraft`)
- โ ุชุญุฏูุซ ูุณูุฏุฉ ููุฌูุฏุฉ (`PUT /api/orders/:id`)
- โ ุฅูุดุงุก ูุณูุฏุฉ ุฌุฏูุฏุฉ ูู POS
- โ ุงูุชุญูู ูู ุฃู ุงูููู ูุญููุธุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

---

## ุงูุงุฎุชุจุงุฑุงุช ุงูุชู ุชู ุฅุนุฏุงุฏูุง

### โ TEST 1: ุฅูุดุงุก ูุณูุฏุฉ ุฌุฏูุฏุฉ ุนุจุฑ `/api/orders`

**ุงููุฏุฎูุงุช:**
```json
{
  "branch": "china_town",
  "table_code": "1",
  "status": "DRAFT",
  "lines": [
    {
      "type": "meta",
      "taxPct": 15
    },
    {
      "type": "item",
      "product_id": 1,
      "quantity": 2,
      "price": 100,
      "discount": 10
    },
    {
      "type": "item",
      "product_id": 2,
      "quantity": 3,
      "price": 50,
      "discount": 0
    }
  ]
}
```

**ุงููุชุงุฆุฌ ุงููุชููุนุฉ:**
- `subtotal`: 350 (2ร100 + 3ร50)
- `discount_amount`: 10
- `tax_amount`: 51 ((350-10)ร15/100)
- `total_amount`: 391 (350-10+51)

**ูุง ูุชู ุงูุชุญูู ููู:**
- โ ุงูููู ููุฌูุฏุฉ ูู ุงุณุชุฌุงุจุฉ API
- โ ุงูููู ููุฌูุฏุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุงูุญุณุงุจุงุช ุตุญูุญุฉ

### โ TEST 2: ุญูุธ ูุณูุฏุฉ ูู POS (`/api/pos/saveDraft`)

**ุงููุฏุฎูุงุช:**
```json
{
  "branch": "china_town",
  "table": "2",
  "items": [
    {"id": 1, "quantity": 1, "price": 200, "discount": 20},
    {"id": 2, "quantity": 2, "price": 75, "discount": 0}
  ],
  "taxPct": 15
}
```

**ุงููุชุงุฆุฌ ุงููุชููุนุฉ:**
- `subtotal`: 350 (1ร200 + 2ร75)
- `discount_amount`: 20
- `tax_amount`: 49.5 ((350-20)ร15/100)
- `total_amount`: 379.5 (350-20+49.5)

**ูุง ูุชู ุงูุชุญูู ููู:**
- โ ุงูููู ูุญุณูุจุฉ ุชููุงุฆูุงู ูู `handleSaveDraft`
- โ ุงูููู ููุญุฏุซุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุงูููู ุตุญูุญุฉ ูู ุงูุงุณุชุฌุงุจุฉ

### โ TEST 3: ุชุญุฏูุซ ูุณูุฏุฉ (`PUT /api/orders/:id`)

**ุงููุฏุฎูุงุช:**
```json
{
  "lines": [
    {
      "type": "meta",
      "discountPct": 10,
      "taxPct": 15
    },
    {
      "type": "item",
      "product_id": 1,
      "quantity": 5,
      "price": 100,
      "discount": 0
    }
  ]
}
```

**ุงููุชุงุฆุฌ ุงููุชููุนุฉ:**
- `subtotal`: 500 (5ร100)
- `discount_amount`: 50 (500ร10/100 - ุฎุตู ุฅุฌูุงูู)
- `tax_amount`: 67.5 ((500-50)ร15/100)
- `total_amount`: 517.5 (500-50+67.5)

**ูุง ูุชู ุงูุชุญูู ููู:**
- โ ุงูููู ุชูุญุณุจ ุชููุงุฆูุงู ุนูุฏ ุงูุชุญุฏูุซ
- โ ุงูููู ููุญุฏุซุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### โ TEST 4: ุฅูุดุงุก ูุณูุฏุฉ ุฌุฏูุฏุฉ ูู POS

**ุงููุฏุฎูุงุช:**
```json
{
  "branch": "china_town",
  "table": "3",
  "items": [
    {"id": 10, "quantity": 2, "price": 150, "discount": 30},
    {"id": 11, "quantity": 1, "price": 200, "discount": 0}
  ],
  "taxPct": 15
}
```

**ุงููุชุงุฆุฌ ุงููุชููุนุฉ:**
- `subtotal`: 500 (2ร150 + 1ร200)
- `discount_amount`: 30
- `tax_amount`: 70.5 ((500-30)ร15/100)
- `total_amount`: 540.5 (500-30+70.5)

---

## ุงูุชุบููุฑุงุช ุงููููุฐุฉ ูู ุงูููุฏ

### 1. ุฏุงูุฉ ูุณุงุนุฏุฉ `calculateOrderTotals`
- โ ุญุณุงุจ `subtotal` ูู ูุฌููุน (ุงููููุฉ ร ุงูุณุนุฑ)
- โ ุญุณุงุจ `discount_amount` ูู ุฎุตููุงุช ุงูุนูุงุตุฑ + ุฎุตู ุฅุฌูุงูู
- โ ุญุณุงุจ `tax_amount` = ((subtotal - discount_amount) ร taxPct) / 100
- โ ุญุณุงุจ `total_amount` = subtotal - discount_amount + tax_amount
- โ ุงุณุชุฎุฑุงุฌ ูุนูููุงุช ุงูุนููู ูู `meta` ุฃู `lines`

### 2. ุชุนุฏูู `handleCreateOrder`
- โ ุญุณุงุจ ุงูููู ุชููุงุฆูุงู ูุจู ุงูุฅุฏุฑุงุฌ
- โ ุชุญุฏูุซ ุฌููุน ุงูุฃุนูุฏุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:
  - `subtotal`
  - `discount_amount`
  - `tax_amount`
  - `total_amount`
  - `customer_name`
  - `customer_phone`
  - `customerid`

### 3. ุชุนุฏูู `handleUpdateOrder`
- โ ุญุณุงุจ ุงูููู ุชููุงุฆูุงู ุนูุฏ ุชุญุฏูุซ `lines`
- โ ุชุญุฏูุซ ุงูุฃุนูุฏุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### 4. ุชุนุฏูู `handleSaveDraft`
- โ ุชูุญูุฏ ููุทู ุงูุญุณุงุจ ููุทุงุจู ุงูููุงุตูุฉ
- โ ุชุญุฏูุซ ุงูุฃุนูุฏุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุนูุฏ ุฅูุดุงุก/ุชุญุฏูุซ ุงููุณูุฏุฉ

---

## ููููุฉ ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช

### ุฎุทูุฉ 1: ุชุดุบูู ุงูุฎุงุฏู

```bash
cd backend
npm start
```

**ุชุฃูุฏ ูู:**
- โ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุชุตูุฉ
- โ ุฌููุน ุงูุฃุนูุฏุฉ ููุฌูุฏุฉ ูู ุฌุฏูู `orders`
- โ ุงูุฎุงุฏู ูุนูู ุนูู `http://localhost:10000`

### ุฎุทูุฉ 2: ุชุดุบูู ุงูุงุฎุชุจุงุฑ ุงูุขูู

```bash
node test_draft_calculations.js
```

**ุงููุชุงุฆุฌ ุงููุชููุนุฉ:**
```
๐งช ุจุฏุก ุงูุงุฎุชุจุงุฑ ุงูุดุงูู ูุญุณุงุจุงุช ุงููุณูุฏุงุช
============================================================

[TEST 1] ุชุณุฌูู ุงูุฏุฎูู
โ ุชุณุฌูู ุงูุฏุฎูู ูุฌุญ

[TEST 2] ุฅูุดุงุก ูุณูุฏุฉ ุฌุฏูุฏุฉ ูุน ุญุณุงุจ ุงูููู ุชููุงุฆูุงู
ุงูููู ุงููุญุณูุจุฉ: { subtotal: 350, discount_amount: 10, tax_amount: 51, total_amount: 391 }
โ ุงูุญุณุงุจุงุช ุตุญูุญุฉ ูู ุงูุงุณุชุฌุงุจุฉ
โ ุงูุญุณุงุจุงุช ุตุญูุญุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

[TEST 3] ุญูุธ ูุณูุฏุฉ ูู POS ูุน ุญุณุงุจ ุงูููู
โ ุงูุญุณุงุจุงุช ุตุญูุญุฉ ูู saveDraft
โ ุงูุญุณุงุจุงุช ุตุญูุญุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุนุฏ saveDraft

[TEST 4] ุชุญุฏูุซ ูุณูุฏุฉ ูุน ุญุณุงุจ ุงูููู ุชููุงุฆูุงู
โ ุงูุญุณุงุจุงุช ุตุญูุญุฉ ุจุนุฏ ุงูุชุญุฏูุซ
โ ุงูุญุณุงุจุงุช ุตุญูุญุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุนุฏ ุงูุชุญุฏูุซ

[TEST 5] ุฅูุดุงุก ูุณูุฏุฉ ุฌุฏูุฏุฉ ูู POS
โ ุงูุญุณุงุจุงุช ุตุญูุญุฉ ูู ูุณูุฏุฉ ุฌุฏูุฏุฉ ูู POS
โ ุงูุญุณุงุจุงุช ุตุญูุญุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูููุณูุฏุฉ ุงูุฌุฏูุฏุฉ

============================================================
โโ ุฌููุน ุงูุงุฎุชุจุงุฑุงุช ูุฌุญุช!
```

---

## ููุงุญุธุงุช ูููุฉ

1. **ุฌููุน ุงูุญุณุงุจุงุช ุชููุงุฆูุฉ** - ูุง ุญุงุฌุฉ ูุชุญุฏูุซ ูุฏูู
2. **ุงูููู ุชูุญุฏุซ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุจุงุดุฑุฉ** - ุนูุฏ ุฅูุดุงุก ุฃู ุชุญุฏูุซ ูุณูุฏุฉ
3. **ุงูููู ููุฌูุฏุฉ ูู ุงูุงุณุชุฌุงุจุฉ** - ูููุตูู ุงูุณุฑูุน ูู ุงููุงุฌูุฉ
4. **ุงูููู ูุชุทุงุจูุฉ** - ุจูู `lines[0].meta` ูุฃุนูุฏุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช

---

## ุงูุฑูุงุจุท ุงููููุฉ

- **ุงูุฎุงุฏู ุงููุญูู:** `http://localhost:10000`
- **API Base:** `http://localhost:10000/api`
- **Health Check:** `http://localhost:10000/health`
- **ุฏููู ุงูุงุฎุชุจุงุฑ:** `TESTING_GUIDE.md`
- **ููู ุงูุงุฎุชุจุงุฑ:** `test_draft_calculations.js`

---

**ุชุงุฑูุฎ ุงูุฅูุดุงุก:** $(Get-Date -Format "yyyy-MM-dd HH:mm:ss")
**ุงูุญุงูุฉ:** โณ ูู ุงูุชุธุงุฑ ุชุดุบูู ุงูุฎุงุฏู ูุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช
