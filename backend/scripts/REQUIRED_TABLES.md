# ๐ ูุงุฆูุฉ ุงูุฌุฏุงูู ุงููุทููุจุฉ ููุธุงู POS

## โ ุงูุฌุฏุงูู ุงูุฃุณุงุณูุฉ (Core Tables)

### 1. **users** (ุงููุณุชุฎุฏููู)
- **ุงููุตู**: ุฌุฏูู ุงููุณุชุฎุฏููู ูุงููุธุงู
- **ุงูุฃุนูุฏุฉ ุงูุฃุณุงุณูุฉ**: id, email, password, role, default_branch, is_active, created_at
- **ุงูุญุงูุฉ**: โ ููุฌูุฏ ูู ุงููุธุงู

### 2. **user_permissions** (ุตูุงุญูุงุช ุงููุณุชุฎุฏููู)
- **ุงููุตู**: ุตูุงุญูุงุช ุงููุณุชุฎุฏููู ุนูู ุงูุดุงุดุงุช ูุงููุฑูุน
- **ุงูุฃุนูุฏุฉ ุงูุฃุณุงุณูุฉ**: user_id, screen_code, branch_code, action_code, allowed
- **ุงูุญุงูุฉ**: โ ููุฌูุฏ ูู ุงููุธุงู

### 3. **settings** (ุงูุฅุนุฏุงุฏุงุช)
- **ุงููุตู**: ุฅุนุฏุงุฏุงุช ุงููุธุงู ุงูุนุงูุฉ
- **ุงูุฃุนูุฏุฉ ุงูุฃุณุงุณูุฉ**: key (PRIMARY KEY), value (JSONB), updated_at
- **ุงูุญุงูุฉ**: โ ููุฌูุฏ ูู ุงููุธุงู

### 4. **partners** (ุงูุนููุงุก ูุงูููุฑุฏูู)
- **ุงููุตู**: ุงูุนููุงุก ูุงูููุฑุฏูู
- **ุงูุฃุนูุฏุฉ ุงูุฃุณุงุณูุฉ**: id, name, type, email, phone, customer_type, contact_info (JSONB), account_id, status, is_active
- **ุงูุญุงูุฉ**: โ ููุฌูุฏ ูู ุงููุธุงู

### 5. **employees** (ุงูููุธููู)
- **ุงููุตู**: ุจูุงูุงุช ุงูููุธููู ูุงูุฑูุงุชุจ
- **ุงูุฃุนูุฏุฉ ุงูุฃุณุงุณูุฉ**: id, full_name, first_name, last_name, national_id, employee_number, status, phone, email, basic_salary, gosi_enrolled, etc.
- **ุงูุญุงูุฉ**: โ ููุฌูุฏ ูู ุงููุธุงู

---

## ๐ฐ ุงูุฌุฏุงูู ุงููุงููุฉ (Accounting Tables)

### 6. **accounts** (ุงูุญุณุงุจุงุช)
- **ุงููุตู**: ุดุฌุฑุฉ ุงูุญุณุงุจุงุช ุงููุญุงุณุจูุฉ
- **ุงูุฃุนูุฏุฉ ุงูุฃุณุงุณูุฉ**: id, account_number, account_code, name, name_en, type, nature, parent_id, opening_balance, allow_manual_entry
- **ุงูุญุงูุฉ**: โ ููุฌูุฏ ูู ุงููุธุงู
- **ููุงุญุธุฉ**: ูุฌุจ ุฃู ูุญุชูู ุนูู ุงูุญุณุงุจุงุช ุงูุฃุณุงุณูุฉ (1111, 1121, 2141, 4111, 4112, 4121, 4122, 5111, 5112)

### 7. **journal_entries** (ูููุฏ ุงูููููุฉ)
- **ุงููุตู**: ุงููููุฏ ุงููุญุงุณุจูุฉ
- **ุงูุฃุนูุฏุฉ ุงูุฃุณุงุณูุฉ**: id, entry_number, description, date, period, reference_type, reference_id, status, branch, created_at
- **ุงูุญุงูุฉ**: โ ููุฌูุฏ ูู ุงููุธุงู

### 8. **journal_postings** (ุจููุฏ ุงููููุฏ)
- **ุงููุตู**: ุจููุฏ ุงููููุฏ ุงููุญุงุณุจูุฉ (ูุฏูู/ุฏุงุฆู)
- **ุงูุฃุนูุฏุฉ ุงูุฃุณุงุณูุฉ**: id, journal_entry_id, account_id, debit, credit, created_at
- **ุงูุญุงูุฉ**: โ ููุฌูุฏ ูู ุงููุธุงู

### 9. **accounting_periods** (ุงููุชุฑุงุช ุงููุญุงุณุจูุฉ)
- **ุงููุตู**: ุงููุชุฑุงุช ุงููุญุงุณุจูุฉ (ุดูุฑูุฉ/ุณูููุฉ)
- **ุงูุฃุนูุฏุฉ ุงูุฃุณุงุณูุฉ**: id, period (UNIQUE), status, opened_at, closed_at, created_at
- **ุงูุญุงูุฉ**: โ ููุฌูุฏ ูู ุงููุธุงู

---

## ๐ ุงูุฌุฏุงูู ุงูุชุฌุงุฑูุฉ (Sales & Purchases)

### 10. **products** (ุงูููุชุฌุงุช)
- **ุงููุตู**: ุงูููุชุฌุงุช ูุงูุฎุฏูุงุช
- **ุงูุฃุนูุฏุฉ ุงูุฃุณุงุณูุฉ**: id, name, name_en, sku, barcode, category, unit, price, cost, tax_rate, stock_quantity, min_stock, description, is_active
- **ุงูุญุงูุฉ**: โ ููุฌูุฏ ูู ุงููุธุงู

### 11. **invoices** (ููุงุชูุฑ ุงููุจูุนุงุช)
- **ุงููุตู**: ููุงุชูุฑ ุงููุจูุนุงุช
- **ุงูุฃุนูุฏุฉ ุงูุฃุณุงุณูุฉ**: id, number, invoice_number (UNIQUE), date, customer_id, lines (JSONB), subtotal, discount_pct, discount_amount, tax_pct, tax_amount, total, payment_method, status, branch, journal_entry_id, closed_at, created_at, updated_at
- **ุงูุญุงูุฉ**: โ ููุฌูุฏ ูู ุงููุธุงู
- **ููุงุญุธุฉ**: `lines` ูุญุชูู ุนูู ุฃุตูุงู ุงููุงุชูุฑุฉ (JSONB) - ูุง ููุฌุฏ ุฌุฏูู `invoice_items` ูููุตู

### 12. **orders** (ุงูุทูุจุงุช - POS)
- **ุงููุตู**: ุทูุจุงุช ููุงุท ุงูุจูุน
- **ุงูุฃุนูุฏุฉ ุงูุฃุณุงุณูุฉ**: id, branch, table_code, lines (JSONB), status, subtotal, discount_amount, tax_amount, total_amount, customerId, customer_name, customer_phone, invoice_id, closed_at, created_at, updated_at
- **ุงูุญุงูุฉ**: โ ููุฌูุฏ ูู ุงููุธุงู

### 13. **supplier_invoices** (ููุงุชูุฑ ุงูููุฑุฏูู)
- **ุงููุตู**: ููุงุชูุฑ ุงูุดุฑุงุก ูู ุงูููุฑุฏูู
- **ุงูุฃุนูุฏุฉ ุงูุฃุณุงุณูุฉ**: id, number (UNIQUE), date, due_date, supplier_id, lines (JSONB), subtotal, discount_pct, discount_amount, tax_pct, tax_amount, total, payment_method, status, branch
- **ุงูุญุงูุฉ**: โ ููุฌูุฏ ูู ุงููุธุงู

### 14. **payments** (ุงููุฏููุนุงุช)
- **ุงููุตู**: ุงููุฏููุนุงุช ุงููุณุชููุฉ
- **ุงูุฃุนูุฏุฉ ุงูุฃุณุงุณูุฉ**: id, invoice_id, amount, method, date, branch, created_at
- **ุงูุญุงูุฉ**: โ ููุฌูุฏ ูู ุงููุธุงู

### 15. **expenses** (ุงููุตุฑููุงุช)
- **ุงููุตู**: ุงููุตุฑููุงุช ูุงููุฏููุนุงุช
- **ุงูุฃุนูุฏุฉ ุงูุฃุณุงุณูุฉ**: id, invoice_number, type, amount, total, account_code, partner_id, description, status, branch, date, payment_method, items (JSONB), created_at, updated_at
- **ุงูุญุงูุฉ**: โ ููุฌูุฏ ูู ุงููุธุงู

---

## ๐ข ุฌุฏุงูู ุงููุฑูุน ูุงูุทุงููุงุช (Branch & POS Tables)

### 16. **branch_accounts** (ุญุณุงุจุงุช ุงููุฑูุน) โ๏ธ **ูุงูุต**
- **ุงููุตู**: ุฑุจุท ุงูุญุณุงุจุงุช ุจุงููุฑูุน (ูุจูุนุงุชุ ูุฏููุนุงุชุ ุถุฑูุจุฉ)
- **ุงูุฃุนูุฏุฉ ุงูุฃุณุงุณูุฉ**: id, branch_id, branch_name, account_type, account_number, account_id, is_active, created_at, updated_at
- **ุงูุญุงูุฉ**: โ **ูุฌุจ ุฅูุดุงุคู**
- **ุงูุงุณุชุฎุฏุงู**: ุชุญุฏูุฏ ุญุณุงุจ ุงููุจูุนุงุช ูุทุฑููุฉ ุงูุฏูุน ููู ูุฑุน

### 17. **pos_tables** (ุทุงููุงุช POS) โ๏ธ **ูุงูุต**
- **ุงููุตู**: ุทุงููุงุช ููุงุท ุงูุจูุน ูุญุงูุชูุง
- **ุงูุฃุนูุฏุฉ ุงูุฃุณุงุณูุฉ**: id, branch, table_code (UNIQUE per branch), table_name, status, current_order_id, capacity, location, is_active, created_at, updated_at
- **ุงูุญุงูุฉ**: โ **ูุฌุจ ุฅูุดุงุคู**
- **ุงูุงุณุชุฎุฏุงู**: ุฅุฏุงุฑุฉ ุญุงูุฉ ุงูุทุงููุงุช (AVAILABLE, BUSY, RESERVED)

### 18. **order_drafts** (ูุณูุฏุงุช ุงูุทูุจุงุช) โ๏ธ **ูุงูุต**
- **ุงููุตู**: ูุณุฎ ุงุญุชูุงุทูุฉ ููุณูุฏุงุช ุงูุทูุจุงุช
- **ุงูุฃุนูุฏุฉ ุงูุฃุณุงุณูุฉ**: id, order_id, branch, table_code, lines (JSONB), status, created_at, updated_at
- **ุงูุญุงูุฉ**: โ **ูุฌุจ ุฅูุดุงุคู**
- **ุงูุงุณุชุฎุฏุงู**: ุญูุธ ุงููุณูุฏุงุช ูุจู ุฅุตุฏุงุฑ ุงููุงุชูุฑุฉ

---

## ๐ ุฌุฏุงูู ุงูุณุฌูุงุช ูุงูุชุฏููู (Audit Tables)

### 19. **audit_log** (ุณุฌู ุงูุชุฏููู)
- **ุงููุตู**: ุณุฌู ุฃูุดุทุฉ ุงููุณุชุฎุฏููู
- **ุงูุฃุนูุฏุฉ ุงูุฃุณุงุณูุฉ**: id, user_id, screen_code, action_code, allowed, ip_address, user_agent, created_at
- **ุงูุญุงูุฉ**: โ ููุฌูุฏ ูู ุงููุธุงู (ูุชู ุฅูุดุงุคู ุชููุงุฆููุง)

---

## ๐ ููุงุญุธุงุช ูููุฉ

### โ๏ธ ุฌุฏุงูู ุบูุฑ ููุฌูุฏุฉ (ูุฌุจ ุฅูุดุงุคูุง):

1. **branch_accounts** - ุถุฑูุฑู ูุชุญุฏูุฏ ุญุณุงุจุงุช ุงููุฑูุน
2. **pos_tables** - ุถุฑูุฑู ูุฅุฏุงุฑุฉ ุทุงููุงุช POS
3. **order_drafts** - ูููุฏ ูุญูุธ ุงููุณูุฏุงุช (ุงุฎุชูุงุฑู ููู ูููุตู ุจู)

### โ ุฌุฏุงูู ููุฌูุฏุฉ ููู ูุฏ ุชุญุชุงุฌ ุฃุนูุฏุฉ ุฅุถุงููุฉ:

1. **invoices** - ูุญุชุงุฌ `journal_entry_id` ู `closed_at` (ูุชู ุฅุถุงูุชูุง ุชููุงุฆููุง)
2. **orders** - ูุญุชุงุฌ `closed_at` (ูุชู ุฅุถุงูุชูุง ุชููุงุฆููุง)
3. **journal_entries** - ูุญุชุงุฌ `branch` (ูุชู ุฅุถุงูุชูุง ุชููุงุฆููุง)
4. **accounts** - ูุญุชุงุฌ `account_code` (ูุชู ุฅุถุงูุชูุง ุชููุงุฆููุง)

### โ ุฌุฏุงูู ุบูุฑ ูุทููุจุฉ:

- **invoice_items** - โ **ุบูุฑ ููุฌูุฏ ููุง ูุทููุจ** - ุงูุจูุงูุงุช ูู `invoices.lines` (JSONB)
- **invoice_lines** - โ **ุบูุฑ ููุฌูุฏ ููุง ูุทููุจ** - ุงูุจูุงูุงุช ูู `invoices.lines` (JSONB)

---

## ๐ ููุฎุต ุงูุฌุฏุงูู

| # | ุงุณู ุงูุฌุฏูู | ุงูุญุงูุฉ | ุงูุฃููููุฉ |
|---|------------|--------|----------|
| 1 | users | โ ููุฌูุฏ | ุฃุณุงุณู |
| 2 | user_permissions | โ ููุฌูุฏ | ุฃุณุงุณู |
| 3 | settings | โ ููุฌูุฏ | ุฃุณุงุณู |
| 4 | partners | โ ููุฌูุฏ | ุฃุณุงุณู |
| 5 | employees | โ ููุฌูุฏ | ุฃุณุงุณู |
| 6 | accounts | โ ููุฌูุฏ | ุฃุณุงุณู |
| 7 | journal_entries | โ ููุฌูุฏ | ุฃุณุงุณู |
| 8 | journal_postings | โ ููุฌูุฏ | ุฃุณุงุณู |
| 9 | accounting_periods | โ ููุฌูุฏ | ุฃุณุงุณู |
| 10 | products | โ ููุฌูุฏ | ุฃุณุงุณู |
| 11 | invoices | โ ููุฌูุฏ | ุฃุณุงุณู |
| 12 | orders | โ ููุฌูุฏ | ุฃุณุงุณู |
| 13 | supplier_invoices | โ ููุฌูุฏ | ุฃุณุงุณู |
| 14 | payments | โ ููุฌูุฏ | ุฃุณุงุณู |
| 15 | expenses | โ ููุฌูุฏ | ุฃุณุงุณู |
| 16 | **branch_accounts** | โ **ูุงูุต** | **ุนุงูู** |
| 17 | **pos_tables** | โ **ูุงูุต** | **ุนุงูู** |
| 18 | **order_drafts** | โ **ูุงูุต** | ูุชูุณุท |
| 19 | audit_log | โ ููุฌูุฏ | ููุฎูุถ |

---

## ๐ ุฎุทูุงุช ุงูุฅุตูุงุญ

1. โ ุฅูุดุงุก `branch_accounts`
2. โ ุฅูุดุงุก `pos_tables`
3. โ ุฅูุดุงุก `order_drafts`
4. โ ุฅุถุงูุฉ ุงูุฃุนูุฏุฉ ุงููุงูุตุฉ ููุฌุฏุงูู ุงูููุฌูุฏุฉ
5. โ ุฅูุดุงุก ุงูุญุณุงุจุงุช ุงูุฃุณุงุณูุฉ ูู `accounts`
6. โ ุฅุถุงูุฉ ุจูุงูุงุช ุงููุฑูุน ูู `branch_accounts`
7. โ ุฅุถุงูุฉ ุงูุทุงููุงุช ูู `pos_tables`

**ุงุณุชุฎุฏู ุงูุณูุฑูุจุช**: `backend/scripts/fix_complete_database.cjs` ูุฅุตูุงุญ ูู ุดูุก ุชููุงุฆููุง.
