# ุงูุชุญูู ูู ุงูุณูุฉ ุงููุงููุฉ ุนูุฏ ุฅูุดุงุก ุงููููุฏ ูุงูููุงุชูุฑ
# Fiscal Year Validation for Entries and Invoices

**ุชุงุฑูุฎ ุงูุฅูุดุงุก:** 2026-01-21

---

## โ ุงูุชุญุณููุงุช ุงููุทุจูุฉ

### 1. Middleware ููุชุญูู ูู ุงูุณูุฉ ุงููุงููุฉ

ุชู ุฅูุดุงุก `backend/middleware/fiscalYearCheck.js` ุงูุฐู ูุญุชูู ุนูู:

- **`checkFiscalYearForDate(date)`**: ุฏุงูุฉ ููุชุญูู ูู ุฅููุงููุฉ ุฅูุดุงุก ูููุฏ/ููุงุชูุฑ ูุชุงุฑูุฎ ูุญุฏุฏ
- **`validateFiscalYear(datePath)`**: Middleware ููุชุญูู ูู ุงูุณูุฉ ุงููุงููุฉ ูุจู ุฅูุดุงุก ุงููููุฏ/ุงูููุงุชูุฑ

### 2. ุชุทุจูู ุงูุชุญูู ุนูู Endpoints

ุชู ุฅุถุงูุฉ `validateFiscalYear('body.date')` ุนูู:

- โ `POST /journal` - ุฅูุดุงุก ููุฏ ูุฏูู
- โ `POST /api/journal` - ุฅูุดุงุก ููุฏ ูุฏูู (API)
- โ๏ธ `POST /api/invoices` - ุฅูุดุงุก ูุงุชูุฑุฉ ูุจูุนุงุช (ูุณุชุฎุฏู `checkAccountingPeriod` ุญุงููุงู)
- โ๏ธ `POST /api/expenses` - ุฅูุดุงุก ูุตุฑูู (ูุญุชุงุฌ ุฅุถุงูุฉ)
- โ๏ธ `POST /api/supplier-invoices` - ุฅูุดุงุก ูุงุชูุฑุฉ ููุฑุฏ (ูุญุชุงุฌ ุฅุถุงูุฉ)

### 3. ุขููุฉ ุงูุนูู

1. **ุนูุฏ ุฅูุดุงุก ููุฏ/ูุงุชูุฑุฉ:**
   - ูุชู ุงุณุชุฎุฑุงุฌ ุงูุชุงุฑูุฎ ูู `req.body.date`
   - ูุชู ุงูุจุญุซ ุนู ุงูุณูุฉ ุงููุงููุฉ ุงูุชู ุชุญุชูู ุนูู ูุฐุง ุงูุชุงุฑูุฎ
   - ูุชู ุงูุชุญูู ูู ุฃู ุงูุณูุฉ ุงููุงููุฉ:
     - ููุฌูุฏุฉ (`status = 'open'` ุฃู `temporary_open = true`)
     - ุบูุฑ ูุบููุฉ
   - ุฅุฐุง ูุงูุช ูุบููุฉุ ูุชู ุฑูุถ ุงูุทูุจ ุจุฑุณุงูุฉ ุฎุทุฃ ูุงุถุญุฉ

2. **ุนูุฏ ูุชุญ ุณูุฉ ุณุงุจูุฉ ูุคูุชุงู:**
   - ูููู ูุชุญ ุณูุฉ ูุบููุฉ ูุคูุชุงู ุจุฅุฏุฎุงู ุณุจุจ
   - ูููู ุฅูุดุงุก ูููุฏ/ููุงุชูุฑ ูู ุงูุณูุฉ ุงูููุชูุญุฉ ูุคูุชุงู
   - ูุฌุจ ุฅุบูุงู ุงููุชุญ ุงููุคูุช ุจุนุฏ ุงูุงูุชูุงุก

3. **ุนุฑุถ ุงูุจูุงูุงุช:**
   - ุงูุจูุงูุงุช ุชุธูุฑ ูู ุงูููุงุฆู ุญุณุจ ุงูุชุงุฑูุฎ (`from` ู `to`)
   - ุงูุชูุงุฑูุฑ ุชุณุชุฎุฏู ููุณ ุงูููุชุฑุฉ ุญุณุจ ุงูุชุงุฑูุฎ
   - ุงูุจูุงูุงุช ุชุธูุฑ ูู ุงูุณูุฉ ุงูุตุญูุญุฉ ุชููุงุฆูุงู

---

## ๐ ุณูุฑ ุงูุนูู ุงูููุตู ุจู

### ูุชุญ ุณูุฉ ุณุงุจูุฉ ูุฅุฏุฎุงู ุจูุงูุงุช:

1. **ูุชุญ ุงูุณูุฉ ุงููุงููุฉ ุงูุณุงุจูุฉ:**
   ```
   POST /api/fiscal-years/:id/temporary-open
   Body: { "reason": "ุฅุฏุฎุงู ุจูุงูุงุช ูุชุฃุฎุฑุฉ" }
   ```

2. **ุฅูุดุงุก ุงููููุฏ/ุงูููุงุชูุฑ:**
   - ุงููุธุงู ูุชุญูู ุชููุงุฆูุงู ูู ุฃู ุงูุณูุฉ ุงููุงููุฉ ููุชูุญุฉ
   - ูููู ุฅูุดุงุก ุงููููุฏ/ุงูููุงุชูุฑ ุจุงูุชุงุฑูุฎ ุงููุทููุจ

3. **ุฅุบูุงู ุงููุชุญ ุงููุคูุช:**
   ```
   POST /api/fiscal-years/:id/temporary-close
   ```

4. **ุนุฑุถ ุงูุจูุงูุงุช:**
   - ุงูุจูุงูุงุช ุชุธูุฑ ูู ุงูููุงุฆู ุนูุฏ ุงุฎุชูุงุฑ ุงููุชุฑุฉ ุงูููุงุณุจุฉ
   - ุงูุชูุงุฑูุฑ ุชุนุฑุถ ุงูุจูุงูุงุช ุญุณุจ ุงูุณูุฉ ุงููุงููุฉ

---

## ๐ ุงูุชุญูู ูู ุงูุจูุงูุงุช

### ุงูุชุญูู ูู ุฃู ุงูุจูุงูุงุช ุชุธูุฑ ูู ุงูุณูุฉ ุงูุตุญูุญุฉ:

1. **ูู ูุงุฆูุฉ ุงููููุฏ:**
   - ุงุณุชุฎุฏู ููุชุฑ `from` ู `to` ูุชุญุฏูุฏ ุงููุชุฑุฉ
   - ุงูุจูุงูุงุช ุชุธูุฑ ุญุณุจ ุงูุชุงุฑูุฎ ููุท

2. **ูู ุงูุชูุงุฑูุฑ:**
   - ุงูุชูุงุฑูุฑ ุชุณุชุฎุฏู `from` ู `to` ูููุชุฑุฉ ุงูุจูุงูุงุช
   - ุงูุจูุงูุงุช ุชุธูุฑ ูู ุงูุณูุฉ ุงูุตุญูุญุฉ ุชููุงุฆูุงู

3. **ูู ุฅุญุตุงุฆูุงุช ุงูุณูุฉ ุงููุงููุฉ:**
   ```
   GET /api/fiscal-years/:id/stats
   ```
   - ูุนุฑุถ ุฅุญุตุงุฆูุงุช ุงูุณูุฉ ุงููุงููุฉ ุญุณุจ `start_date` ู `end_date`

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ

1. **ุงูุชุญูู ุงูุฅูุฒุงูู:**
   - ูุง ูููู ุฅูุดุงุก ูููุฏ/ููุงุชูุฑ ูู ุณูุฉ ูุบููุฉ
   - ูุฌุจ ูุชุญ ุงูุณูุฉ ูุคูุชุงู ุฃููุงู

2. **ุงูุฃูุงู:**
   - ุฌููุน ุนูููุงุช ุงููุชุญ/ุงูุฅุบูุงู ุชุชุทูุจ ุตูุงุญูุงุช
   - ูุชู ุชุณุฌูู ุฌููุน ุงูุฃูุดุทุฉ ูู `fiscal_year_activities`

3. **ุงูุฃุฏุงุก:**
   - ูุชู ุงุณุชุฎุฏุงู cache ููุชุญูู ูู ุงูุณูุฉ ุงููุงููุฉ
   - ุงูุชุญูู ุณุฑูุน ููุง ูุคุซุฑ ุนูู ุงูุฃุฏุงุก

---

## ๐งช ุงุฎุชุจุงุฑ ุงููุธุงู

### ุงุฎุชุจุงุฑ ูุชุญ ุณูุฉ ุณุงุจูุฉ:

1. ุฅูุดุงุก ุณูุฉ ูุงููุฉ 2024 (ูุบููุฉ)
2. ูุชุญูุง ูุคูุชุงู:
   ```bash
   curl -X POST http://localhost:5000/api/fiscal-years/1/temporary-open \
     -H "Authorization: Bearer TOKEN" \
     -H "Content-Type: application/json" \
     -d '{"reason": "ุฅุฏุฎุงู ุจูุงูุงุช ูุชุฃุฎุฑุฉ"}'
   ```

3. ุฅูุดุงุก ููุฏ ุจุชุงุฑูุฎ 2024:
   ```bash
   curl -X POST http://localhost:5000/api/journal \
     -H "Authorization: Bearer TOKEN" \
     -H "Content-Type: application/json" \
     -d '{
       "date": "2024-12-15",
       "description": "ููุฏ ุชุฌุฑูุจู",
       "postings": [...]
     }'
   ```

4. ุงูุชุญูู ูู ุธููุฑ ุงูููุฏ ูู ูุงุฆูุฉ ุงููููุฏ ุนูุฏ ุงุฎุชูุงุฑ ุงููุชุฑุฉ 2024

5. ุฅุบูุงู ุงููุชุญ ุงููุคูุช:
   ```bash
   curl -X POST http://localhost:5000/api/fiscal-years/1/temporary-close \
     -H "Authorization: Bearer TOKEN"
   ```

---

## ๐ ุงูุชุญุฏูุซุงุช ุงููุณุชูุจููุฉ

- [ ] ุฅุถุงูุฉ ุงูุชุญูู ุนูู `POST /api/expenses`
- [ ] ุฅุถุงูุฉ ุงูุชุญูู ุนูู `POST /api/supplier-invoices`
- [ ] ุฅุถุงูุฉ ูุงุฌูุฉ ูุณุชุฎุฏู ููุชุญ/ุฅุบูุงู ุงูุณููุงุช ุงููุงููุฉ
- [ ] ุฅุถุงูุฉ ุฅุดุนุงุฑุงุช ุนูุฏ ูุญุงููุฉ ุฅูุดุงุก ููุฏ ูู ุณูุฉ ูุบููุฉ
