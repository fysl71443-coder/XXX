export function getLang(){
  try { return localStorage.getItem('lang') || 'ar' } catch { return 'ar' }
}

const dict = {
  ar: {
    titles: {
      supplier_cards: 'بطاقات الموردين',
      client_cards: 'بطاقات العملاء',
      employees_cards: 'بطاقات الموظفين',
      sales_orders: 'طلبات البيع',
      purchase_orders: 'طلبات الشراء',
      general_ledger: 'دفتر الأستاذ العام',
      account_ledger: 'كشف حساب',
      expense_invoices: 'فواتير المصروفات',
      expense_invoices_subtitle: 'عرض وإدارة فواتير المصروفات',
      all_supplier_invoices: 'فواتير جميع الموردين',
      outstanding_dues: 'تقرير المستحقات غير المدفوعة',
      journal: 'الحركات المحاسبية / القيود اليومية',
      accounts: 'شاشة الحسابات'
    },
    labels: {
      period: 'الفترة',
      open: 'مفتوحة',
      closed: 'مغلقة',
      date: 'التاريخ',
      from: 'من',
      to: 'إلى',
      jrnl: 'دفتر',
      account: 'الحساب',
      ref: 'مرجع',
      debit: 'مدين',
      credit: 'دائن',
      balance: 'الرصيد',
      totals: 'المجموع',
      order_number: 'رقم الطلب',
      customer: 'العميل',
      supplier: 'المورد',
      activity: 'النشاط',
      status: 'الحالة',
      all: 'الكل',
      draft: 'مسودة',
      posted: 'منشورة',
      reversed: 'معكوس',
      cancelled: 'ملغي',
      partial: 'جزئي',
      paid: 'مدفوع',
      unpaid: 'غير مدفوع',
      amount: 'المبلغ',
      invoice_number: 'رقم الفاتورة',
      order_id: 'رقم الطلب',
      tax: 'الضريبة',
      total: 'الإجمالي',
      name: 'الاسم',
      phone: 'الجوال',
      city: 'المدينة',
      email: 'البريد الإلكتروني',
      vendor_type: 'نوع المورد',
      description: 'الوصف',
      entry_number: 'رقم القيد',
      branch: 'الفرع',
      change_branch: 'تغيير الفرع',
      back: 'رجوع',
      home: 'الرئيسية',
      reload: 'تحديث',
      help: 'مساعدة',
      tables: 'الطاولات',
      manage_tables: 'إدارة الطاولات',
      busy: 'مشغولة',
      free: 'متاحة',
      busy_draft: 'مسودة / مشغولة',
      free_pre: 'بد الإصدار / متاحة',
      close: 'إغلاق',
      delete: 'حذف',
      invoices_list: 'قائمة الفواتير',
      export_excel: 'تصدير Excel',
      export_pdf: 'تصدير PDF',
      exporting: 'جارٍ التصدير...',
      generating: 'جارٍ التوليد...',
      toggle_select_all: 'تحديد/إلغاء تحديد الكل',
      selected: 'المحدد:',
      type: 'النوع',
      actions: 'الإجراءات',
      view: 'عرض',
      edit: 'تعديل',
      reverse: 'عكس القيد',
      payment: 'الدفع',
      invoice_view: 'عرض الفاتورة',
      min_amount: 'أدنى مبلغ',
      max_amount: 'أقصى مبلغ',
      only_unbalanced: 'غير متوازن فقط',
      sort: 'ترتيب',
      date_desc: 'تاريخ تنازلي',
      date_asc: 'تاريخ تصاعدي',
      amount_desc: 'مبلغ تنازلي',
      amount_asc: 'مبلغ تصاعدي',
      search: 'بحث',
      search_placeholder: 'رقم القيد أو الوصف',
      create_entry: 'إنشاء قيد',
      payment_method: 'طريقة الدفع',
      method: 'الطريقة',
      choose_method: 'اختر الطريقة',
      cash: 'نقدا',
      card: 'بطاقة',
      deferred: 'آجل',
      discount_pct: 'خصم %',
      tax_pct: 'ضريبة %',
      multi_pay: 'دفع متعدد',
      add_method: 'إضافة طريقة',
      current_total: 'المجموع الحالي',
      remaining: 'المتبقي',
      required: 'المطلوب',
      account_search: 'بحث حساب',
      select_account: 'اختر حسابًا',
      notes: 'ملاحظات',
      save_draft: 'حفظ المسودة',
      post: 'نشر',
      unbalanced_diff_prefix: 'غير متوازن: الفرق ',
      receipt_summary: 'ملخص الإيصال',
      item: 'الصنف',
      qty: 'الكمية',
      unit_price: 'سعر الوحدة',
      subtotal: 'إجمالي الأصناف',
      discount: 'الخصم',
      vat: 'الضريبة',
      grand_total: 'الإجمالي',
      cancel_invoice: 'إلغاء الفاتورة',
      print_order: 'طباعة الطلب',
      cash_calc: 'حاسبة فرق النقد',
      issue_invoice: 'إصدار الفاتورة',
      add_customer: 'إضافة عميل',
      customer_name: 'اسم العميل',
      customer_phone: 'هاتف العميل',
      supervisor_password: 'كلمة مرور المشرف',
      confirm_cancel: 'تأكيد الإلغاء',
      alert: 'تنبيه',
      ok: 'حسناً',
      welcome: 'مرحبًا',
      table_manager: 'مدير الطاولات',
      manage_sections_help: 'إدارة الأقسام والصفوف والأرقام. اسحب واترك ثم احفظ.',
      add_section: '➕ إضافة قسم',
      section: 'قسم',
      add_row: '➕ إضافة صف',
      row: 'صف',
      remove_row: 'إزالة صف',
      add_numbers_placeholder: 'أدخل أرقام الطاولات',
      example_numbers: 'مثال: 1,2,3,6,8',
      logo_settings_tip: 'إدارة شعار الفرع تتم من شاشة الإعدادات',
      save_changes: 'حفظ التغييرات',
      print: 'طباعة',
      employees: 'الموظفون',
      emp_no: 'رقم الموظف',
      basic: 'الأساسي',
      housing: 'السكن',
      transport: 'النقل',
      other: 'أخرى',
      gosi: 'GOSI',
      pay_type: 'نوع الدفع',
      dues: 'مستحقات',
      disable: 'إيقاف',
      enable: 'تفعيل',
      terminate: 'إنهاء',
      no_data: 'لا توجد بيانات',
      active: 'نشط',
      disabled: 'موقوف',
      terminated: 'منتهي'
    },
    buttons: {
      create_invoice: 'إنشاء فاتورة'
    },
    ui: {
      multiple_payment_title: 'الدفع المتعدد – Multiple Payment',
      edit_payments: 'تعديل طرق الدفع',
      save_payments: 'حفظ طرق الدفع'
    },
    errors: {
      method_duplicate: 'لا يسمح بتكرار نفس الطريقة مرتين',
      no_add_after_complete: 'لا يمكن إضافة طريقة دفع جديدة بعد اكتمال المبلغ',
      amount_exceeds_remaining: 'لا يمكن إدخال مبلغ أكبر من المتبقي للفاتورة',
      payment_method_required: 'طريقة الدفع مطلوبة',
      choose_payment_before_issue: 'يرجى اختيار طريقة الدفع قبل إصدار الفاتورة',
      no_items: 'لا توجد أصناف',
      add_items_first: 'أضف أصنافًا أولاً قبل إصدار الفاتورة',
      discount_required: 'الخصم إلزامي',
      discount_note: 'هذا الخصم خاص بهذه الفاتورة ولن يُحفظ',
      save_draft_failed: 'فشل الإصدار',
      save_draft_failed_note: 'تعذر حفظ المسودة',
      line_method_required: 'طريقة الدفع مطلوبة لكل سطر',
      sum_mismatch: 'اختلاف في مجموع الدفعات',
      sum_mismatch_note: 'يجب أن يساوي مجموع الدفعات إجمالي الفاتورة',
      credit_customer_required: 'العميل مطلوب للآجل'
    },
    messages: {
      are_you_sure: 'هل أنت متأكد؟',
      operation_success: 'تمت العملية بنجاح',
      operation_failed_prefix: 'فشلت العملية: ',
      loading: 'جاري التحميل...',
      period_closed: 'الفترة المحاسبية مغلقة. العمليات للقراءة فقط.',
      no_permission: 'ليست لديك صلاحية لتنفيذ العملية',
      confirm_disable_employee: 'تأكيد إيقاف الموظف؟',
      confirm_enable_employee: 'تأكيد تفعيل الموظف؟',
      confirm_terminate_employee: 'تأكيد إنهاء الموظف؟ سيتم حذف البيانات المرتبطة',
      status_updated: 'تم تحديث الحالة',
      employee_terminated: 'تم إنهاء الموظف'
    }
  },
  en: {
    titles: {
      supplier_cards: 'Supplier Cards',
      client_cards: 'Client Cards',
      employees_cards: 'Employee Cards',
      sales_orders: 'Sales Orders',
      purchase_orders: 'Purchase Orders',
      general_ledger: 'General Ledger',
      account_ledger: 'Account Ledger',
      expense_invoices: 'Expense Invoices',
      expense_invoices_subtitle: 'View and manage expense invoices',
      all_supplier_invoices: 'All Supplier Invoices',
      outstanding_dues: 'Outstanding Dues Report',
      journal: 'Accounting Movements / Journal Entries',
      accounts: 'Accounts Screen'
    },
    labels: {
      period: 'Period',
      open: 'Open',
      closed: 'Closed',
      date: 'Date',
      from: 'From',
      to: 'To',
      jrnl: 'JRNL',
      account: 'Account',
      ref: 'Ref',
      debit: 'Debit',
      credit: 'Credit',
      balance: 'Balance',
      totals: 'Totals',
      order_number: 'Order #',
      customer: 'Customer',
      supplier: 'Supplier',
      activity: 'Activity',
      status: 'Status',
      all: 'All',
      draft: 'Draft',
      posted: 'Posted',
      reversed: 'Reversed',
      cancelled: 'Cancelled',
      partial: 'Partial',
      paid: 'Paid',
      unpaid: 'Unpaid',
      amount: 'Amount',
      invoice_number: 'Invoice #',
      order_id: 'Order ID',
      tax: 'Tax',
      total: 'Total',
      name: 'Name',
      phone: 'Phone',
      city: 'City',
      email: 'Email',
      vendor_type: 'Vendor Type',
      description: 'Description',
      entry_number: 'Entry #',
      branch: 'Branch',
      change_branch: 'Change Branch',
      back: 'Back',
      home: 'Home',
      reload: 'Reload',
      help: 'Help',
      tables: 'Tables',
      manage_tables: 'Manage Tables',
      busy: 'Busy',
      free: 'Free',
      busy_draft: 'Draft / Busy',
      free_pre: 'Pre-issue / Free',
      close: 'Close',
      delete: 'Delete',
      invoices_list: 'Invoices List',
      export_excel: 'Export Excel',
      export_pdf: 'Export PDF',
      exporting: 'Exporting...',
      generating: 'Generating...',
      toggle_select_all: 'Toggle Select All',
      selected: 'Selected:',
      type: 'Type',
      actions: 'Actions',
      view: 'View',
      edit: 'Edit',
      reverse: 'Reverse',
      payment: 'Payment',
      invoice_view: 'Invoice View',
      min_amount: 'Min Amt',
      max_amount: 'Max Amt',
      only_unbalanced: 'Only unbalanced',
      sort: 'Sort',
      date_desc: 'Date desc',
      date_asc: 'Date asc',
      amount_desc: 'Amount desc',
      amount_asc: 'Amount asc',
      search: 'Search',
      search_placeholder: 'Entry # or description',
      create_entry: 'Create Entry',
      payment_method: 'Payment Method',
      method: 'Method',
      choose_method: 'Choose method',
      cash: 'Cash',
      card: 'Card',
      deferred: 'Deferred',
      discount_pct: 'Discount %',
      tax_pct: 'VAT %',
      multi_pay: 'Multi-payment',
      add_method: 'Add Method',
      current_total: 'Current total',
      remaining: 'Remaining',
      required: 'Required',
      account_search: 'Account search',
      select_account: 'Select account',
      notes: 'Notes',
      save_draft: 'Save draft',
      post: 'Post',
      unbalanced_diff_prefix: 'Unbalanced: diff ',
      receipt_summary: 'Receipt Summary',
      item: 'Item',
      qty: 'Qty',
      unit_price: 'Unit Price',
      subtotal: 'Items Subtotal',
      discount: 'Discount',
      vat: 'VAT',
      grand_total: 'TOTAL',
      cancel_invoice: 'Cancel Invoice',
      print_order: 'Print Order',
      cash_calc: 'Cash Difference Calculator',
      issue_invoice: 'Issue Invoice',
      add_customer: 'Add Customer',
      customer_name: 'Customer Name',
      customer_phone: 'Customer Phone',
      supervisor_password: 'Supervisor Password',
      confirm_cancel: 'Confirm Cancellation',
      alert: 'Alert',
      ok: 'OK',
      welcome: 'Welcome',
      table_manager: 'Table Manager',
      manage_sections_help: 'Manage sections, rows, and table numbers. Drag and drop freely, then save.',
      add_section: '➕ Add Section',
      section: 'Section',
      add_row: '➕ Add Row',
      row: 'Row',
      remove_row: 'Remove Row',
      add_numbers_placeholder: 'Add numbers',
      example_numbers: 'Example: 1,2,3,6,8',
      logo_settings_tip: 'Branch logo is managed from Settings',
      save_changes: 'Save Changes',
      print: 'Print',
      employees: 'Employees',
      emp_no: 'Emp No.',
      basic: 'Basic',
      housing: 'Housing',
      transport: 'Transport',
      other: 'Other',
      gosi: 'GOSI',
      pay_type: 'Pay type',
      dues: 'Dues',
      disable: 'Disable',
      enable: 'Enable',
      terminate: 'Terminate',
      no_data: 'No data',
      active: 'Active',
      disabled: 'Disabled',
      terminated: 'Terminated'
    },
    buttons: {
      create_invoice: 'Create Invoice'
    },
    ui: {
      multiple_payment_title: 'Multiple Payment',
      edit_payments: 'Edit Payments',
      save_payments: 'Save Payments'
    },
    errors: {
      method_duplicate: 'Duplicate method is not allowed',
      no_add_after_complete: 'Cannot add a new payment method after amount is complete',
      amount_exceeds_remaining: 'Cannot enter an amount larger than remaining',
      payment_method_required: 'Payment method required',
      choose_payment_before_issue: 'Please choose a payment method before issue',
      no_items: 'No items',
      add_items_first: 'Add items first before issuing the invoice',
      discount_required: 'Discount is mandatory',
      discount_note: 'This discount is specific to this invoice and will not be saved',
      save_draft_failed: 'Issue failed',
      save_draft_failed_note: 'Could not save draft',
      line_method_required: 'Payment method is required for each line',
      sum_mismatch: 'Difference in payment totals',
      sum_mismatch_note: 'Payments total must equal the invoice total',
      credit_customer_required: 'Customer is required for deferred'
    },
    messages: {
      are_you_sure: 'Are you sure?',
      operation_success: 'Operation successful',
      operation_failed_prefix: 'Operation failed: ',
      loading: 'Loading...',
      period_closed: 'The accounting period is closed. Transactions are read-only.',
      no_permission: 'You do not have permission to perform this action',
      confirm_disable_employee: 'Confirm disable employee?',
      confirm_enable_employee: 'Confirm enable employee?',
      confirm_terminate_employee: 'Confirm terminate employee? Related data will be removed',
      status_updated: 'Status updated',
      employee_terminated: 'Employee terminated'
    }
  }
}

export function t(key, lang){
  const l = (lang || getLang()).toLowerCase() === 'ar' ? 'ar' : 'en'
  const parts = String(key||'').split('.')
  let cur = dict[l]
  for (const p of parts){ cur = cur && cur[p] }
  return (cur == null ? key : cur)
}