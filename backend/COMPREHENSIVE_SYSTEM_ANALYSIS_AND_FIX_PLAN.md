# ุชุญููู ุดุงูู ูููุธุงู ูุฎุทุฉ ุงูุฅุตูุงุญ ุงููุชูุงููุฉ
# Comprehensive System Analysis & Fix Plan

**ุงูุชุงุฑูุฎ**: 2026-01-19  
**ุงูุฅุตุฏุงุฑ**: 1.0  
**ุงูุญุงูุฉ**: ุชุญููู ูุงูู - ุฌุงูุฒ ููุชูููุฐ

---

## ๐ ุฌุฏูู ุงููุญุชููุงุช

1. [ูุธุฑุฉ ุนุงูุฉ ุนูู ุงููุธุงู](#1-ูุธุฑุฉ-ุนุงูุฉ-ุนูู-ุงููุธุงู)
2. [ุชุญููู ุงูููููุงุช](#2-ุชุญููู-ุงูููููุงุช)
3. [ุงููุดุงูู ุงูููุชุดูุฉ](#3-ุงููุดุงูู-ุงูููุชุดูุฉ)
4. [ุชุญููู ุงูุฃุณุจุงุจ ุงูุฌุฐุฑูุฉ](#4-ุชุญููู-ุงูุฃุณุจุงุจ-ุงูุฌุฐุฑูุฉ)
5. [ุฎุทุฉ ุงูุฅุตูุงุญ ุงููุชูุงููุฉ](#5-ุฎุทุฉ-ุงูุฅุตูุงุญ-ุงููุชูุงููุฉ)
6. [ุฎุทูุงุช ุงูุชูููุฐ](#6-ุฎุทูุงุช-ุงูุชูููุฐ)
7. [ุฎุทุฉ ุงูุงุฎุชุจุงุฑ](#7-ุฎุทุฉ-ุงูุงุฎุชุจุงุฑ)
8. [ุงูุชูุฑูุฑ ุงูููุงุฆู](#8-ุงูุชูุฑูุฑ-ุงูููุงุฆู)

---

## 1. ูุธุฑุฉ ุนุงูุฉ ุนูู ุงููุธุงู

### 1.1 ูุตู ุงููุธุงู
ูุธุงู ูุญุงุณุจู ูุชูุงูู (ERP) ูุฅุฏุงุฑุฉ ุงููุทุงุนู/ุงูููุงูู ูุชุถูู:
- **ููุทุฉ ุงูุจูุน (POS)**: ุฅุฏุงุฑุฉ ุงูุทูุจุงุช ูุงูููุงุชูุฑ
- **ุงููุญุงุณุจุฉ**: ูุธุงู ูููุฏ ูุญุงุณุจูุฉ ูุงูู
- **ุฅุฏุงุฑุฉ ุงูุนููุงุก ูุงูููุฑุฏูู**: CRM ุฃุณุงุณู
- **ุงูุชูุงุฑูุฑ ุงููุงููุฉ**: ุชูุงุฑูุฑ ูุจูุนุงุช ูููุฒุงููุงุช
- **ุฅุฏุงุฑุฉ ุงููุฎุฒูู**: ุชุชุจุน ุงูููุชุฌุงุช ูุงููููุงุช

### 1.2 ุงูุจููุฉ ุงูุชูููุฉ

#### Backend
- **Framework**: Express.js (Node.js)
- **ูุงุนุฏุฉ ุงูุจูุงูุงุช**: PostgreSQL
- **ORM**: Prisma (ููุญุณุงุจุงุช) + Raw SQL (ููุจุงูู)
- **ุงููุตุงุฏูุฉ**: JWT
- **ุงูุตูุงุญูุงุช**: ูุธุงู ูุฎุตุต (authorize middleware)

#### Frontend
- **Framework**: React.js
- **Routing**: React Router
- **State Management**: Context API
- **UI**: Custom CSS + Tailwind (ุฌุฒุฆู)

#### Infrastructure
- **Deployment**: Render.com (ููุชุฑุถ)
- **Environment**: Production + Development

---

## 2. ุชุญููู ุงูููููุงุช

### 2.1 ูุงุนุฏุฉ ุงูุจูุงูุงุช

#### ุงูุฌุฏุงูู ุงูุฑุฆูุณูุฉ:
1. **accounts** - ุงูุญุณุงุจุงุช ุงููุญุงุณุจูุฉ
2. **journal_entries** - ุงููููุฏ ุงููุญุงุณุจูุฉ
3. **journal_postings** - ุชูุงุตูู ุงููููุฏ
4. **invoices** - ุงูููุงุชูุฑ
5. **orders** - ุงูุทูุจุงุช
6. **pos_tables** - ุทุงููุงุช POS
7. **products** - ุงูููุชุฌุงุช
8. **partners** - ุงูุนููุงุก ูุงูููุฑุฏูู
9. **expenses** - ุงููุตุฑููุงุช
10. **settings** - ุงูุฅุนุฏุงุฏุงุช

#### ุงููุดุงูู ุงูููุชุดูุฉ:
- โ **ุชู ุงูุฅุตูุงุญ**: ุชูุฑุงุฑ ุงูุญุณุงุจุงุช (account_code duplicates)
- โ **ุชู ุงูุฅุตูุงุญ**: missing updated_at ูู pos_tables
- โ๏ธ **ููุฏ ุงููุฑุงุฌุนุฉ**: ุนุฏู ุชุทุงุจู ุจูู Prisma schema ูุงูุฌุฏุงูู ุงููุนููุฉ

### 2.2 Backend API

#### ุงูู Endpoints ุงูุฑุฆูุณูุฉ:
- `/api/auth/*` - ุงููุตุงุฏูุฉ
- `/api/pos/*` - ููุทุฉ ุงูุจูุน
- `/api/orders/*` - ุงูุทูุจุงุช
- `/api/invoices/*` - ุงูููุงุชูุฑ
- `/api/journal/*` - ุงููููุฏ ุงููุญุงุณุจูุฉ
- `/api/reports/*` - ุงูุชูุงุฑูุฑ
- `/api/settings/*` - ุงูุฅุนุฏุงุฏุงุช

#### ุงููุดุงูู ุงูููุชุดูุฉ:
- โ **ุชู ุงูุฅุตูุงุญ**: API Contract ุบูุฑ ููุชูู
- โ๏ธ **ููุฏ ุงููุฑุงุฌุนุฉ**: ุงุฒุฏูุงุฌูุฉ ูู ุฃุณูุงุก ุงููุณุงุฑุงุช
- โ๏ธ **ููุฏ ุงููุฑุงุฌุนุฉ**: ุนุฏู ุชูุญูุฏ RESTful naming

### 2.3 Frontend

#### ุงูููููุงุช ุงูุฑุฆูุณูุฉ:
- **AuthContext** - ุฅุฏุงุฑุฉ ุงููุตุงุฏูุฉ
- **POSInvoice** - ูุงุฌูุฉ ุงูููุงุชูุฑ
- **Journal** - ูุงุฌูุฉ ุงููููุฏ
- **Reports** - ูุงุฌูุฉ ุงูุชูุงุฑูุฑ
- **Accounts** - ูุงุฌูุฉ ุงูุญุณุงุจุงุช

#### ุงููุดุงูู ุงูููุชุดูุฉ:
- โ๏ธ **ููุฏ ุงููุฑุงุฌุนุฉ**: ุงุณุชุฏุนุงุก endpoints ุจุฃุณูุงุก ูุฎุชููุฉ ุนู Backend
- โ๏ธ **ููุฏ ุงููุฑุงุฌุนุฉ**: ุนุฏู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุจุดูู ููุญุฏ

### 2.4 ุงููุธุงู ุงููุญุงุณุจู

#### ุงูููููุงุช:
- **createInvoiceJournalEntry** - ุฅูุดุงุก ูููุฏ ููููุงุชูุฑ
- **postJournal** - ุชุฑุญูู ุงููููุฏ
- **Reports** - ุชูุงุฑูุฑ ูุงููุฉ

#### ุงููุดุงูู ุงูููุชุดูุฉ:
- โ **ุชู ุงูุฅุตูุงุญ**: Business Day logic ุฎุงุทุฆ
- โ **ุชู ุงูุฅุตูุงุญ**: ุงุณุชุฎุฏุงู account_code ููุท (ุจุฏูู account_number)
- โ๏ธ **ููุฏ ุงููุฑุงุฌุนุฉ**: ุงููููุฏ ุงููุฏููุฉ ูุฏ ูุง ุชุญุชูู ุนูู branch

---

## 3. ุงููุดุงูู ุงูููุชุดูุฉ

### 3.1 ุงููุดุงูู ุงูุญุฑุฌุฉ (Critical) ๐ด

#### C-001: Business Day Logic ุบูุฑ ุตุญูุญ
**ุงูุฃุซุฑ**: ุงูุชูุงุฑูุฑ ูุง ุชุนุฑุถ ุงูุจูุงูุงุช ุจุดูู ุตุญูุญ  
**ุงูุญุงูุฉ**: โ ุชู ุงูุฅุตูุงุญ  
**ุงููุตู**: ุงูุชูุฑูุฑ ูุงู ูุณุชุฎุฏู timestamp ุจุฏูุงู ูู PostgreSQL INTERVAL

#### C-002: ุชูุฑุงุฑ ุงูุญุณุงุจุงุช ุงููุญุงุณุจูุฉ
**ุงูุฃุซุฑ**: ุงูููุฒุงู ูุง ูุชูุงุฒูุ ุงูุชูุงุฑูุฑ ูุถุฑูุจุฉ  
**ุงูุญุงูุฉ**: โ ุชู ุงูุฅุตูุงุญ  
**ุงููุตู**: ููุณ account_code ููุฌูุฏ ูู ุญุณุงุจุงุช ูุชุนุฏุฏุฉ

#### C-003: API Contract ุบูุฑ ููุชูู
**ุงูุฃุซุฑ**: ุฑุณุงุฆู "Unknown endpoint" ูู ูู ููุงู  
**ุงูุญุงูุฉ**: โ ุชู ุงูุฅุตูุงุญ  
**ุงููุตู**: ุงูุนุฏูุฏ ูู ุงูู endpoints ุบูุฑ ูุณุฌูุฉ ูู API_ENDPOINTS

#### C-004: POS Tables Schema ุบูุฑ ูุชูุงูู
**ุงูุฃุซุฑ**: ุฃุฎุทุงุก ุนูุฏ ุชุญุฏูุซ pos_tables  
**ุงูุญุงูุฉ**: โ ุชู ุงูุฅุตูุงุญ  
**ุงููุตู**: ุนููุฏ updated_at ุบูุฑ ููุฌูุฏ

### 3.2 ุงููุดุงูู ุงููุชูุณุทุฉ (Medium) ๐ก

#### M-001: ุงุฒุฏูุงุฌูุฉ ูู ุฃุณูุงุก ุงููุณุงุฑุงุช
**ุงูุฃุซุฑ**: ุงุฑุชุจุงู ูู ุงูุตูุงูุฉุ ุตุนูุจุฉ ูู ุงูุชุชุจุน  
**ุงูุญุงูุฉ**: โ๏ธ ููุฏ ุงููุฑุงุฌุนุฉ  
**ุงููุตู**: 
- `/api/pos/issueInvoice` vs `/api/pos/issue-invoice`
- `/api/settings/settings_company` vs `/api/settings/company`

#### M-002: ุนุฏู ุชูุญูุฏ RESTful naming
**ุงูุฃุซุฑ**: ุตุนูุจุฉ ูู ููู APIุ ุตุนูุจุฉ ูู ุงูุตูุงูุฉ  
**ุงูุญุงูุฉ**: โ๏ธ ููุฏ ุงููุฑุงุฌุนุฉ  
**ุงููุตู**: ุงุณุชุฎุฏุงู camelCase ู kebab-case ู snake_case ุจุดูู ุนุดูุงุฆู

#### M-003: ุนุฏู ุชุทุงุจู Prisma Schema ูุน ุงูุฌุฏุงูู ุงููุนููุฉ
**ุงูุฃุซุฑ**: ูุดุงูู ูู ORMุ ุตุนูุจุฉ ูู ุงูุตูุงูุฉ  
**ุงูุญุงูุฉ**: โ๏ธ ููุฏ ุงููุฑุงุฌุนุฉ  
**ุงููุตู**: Prisma schema ูุง ูุทุงุจู ุงูุฌุฏุงูู ุงููุนููุฉ ูู PostgreSQL

#### M-004: ุงููููุฏ ุงููุญุงุณุจูุฉ ุงููุฏููุฉ ูุฏ ูุง ุชุญุชูู ุนูู branch
**ุงูุฃุซุฑ**: ุงูุชูุงุฑูุฑ ุญุณุจ ุงููุฑุน ูุฏ ุชููู ุบูุฑ ุฏูููุฉ  
**ุงูุญุงูุฉ**: โ๏ธ ููุฏ ุงููุฑุงุฌุนุฉ  
**ุงููุตู**: ุงููููุฏ ุงููุฏููุฉ ูุฏ ูุง ุชุญุชูู ุนูู ุนููุฏ branch

### 3.3 ุงููุดุงูู ุงูููุฎูุถุฉ (Low) ๐ข

#### L-001: ูุซุฑุฉ Debugging logs ูู Production
**ุงูุฃุซุฑ**: ุถุบุท ุนูู ุงูุฃุฏุงุกุ ุตุนูุจุฉ ูู ูุฑุงุกุฉ Logs  
**ุงูุญุงูุฉ**: โ๏ธ ููุฏ ุงููุฑุงุฌุนุฉ  
**ุงููุตู**: ุงูุนุฏูุฏ ูู console.log ูู Production code

#### L-002: ุนุฏู ูุฌูุฏ Error Boundaries ูู ุจุนุถ ุงูููููุงุช
**ุงูุฃุซุฑ**: ุชุทุจูู ูุฏ ูุชุนุทู ุนูุฏ ุญุฏูุซ ุฎุทุฃ  
**ุงูุญุงูุฉ**: โ๏ธ ููุฏ ุงููุฑุงุฌุนุฉ  
**ุงููุตู**: ุจุนุถ ุงูููููุงุช ูุง ุชุญุชูู ุนูู Error Boundaries

#### L-003: ุนุฏู ูุฌูุฏ Unit Tests
**ุงูุฃุซุฑ**: ุตุนูุจุฉ ูู ุงูุชุฃูุฏ ูู ุตุญุฉ ุงูููุฏ  
**ุงูุญุงูุฉ**: โ๏ธ ููุฏ ุงููุฑุงุฌุนุฉ  
**ุงููุตู**: ูุง ุชูุฌุฏ Unit Tests ูููุธุงุฆู ุงูุญุฑุฌุฉ

---

## 4. ุชุญููู ุงูุฃุณุจุงุจ ุงูุฌุฐุฑูุฉ

### 4.1 C-001: Business Day Logic

**ุงูุณุจุจ ุงูุฌุฐุฑู**: ุงุณุชุฎุฏุงู JavaScript Date objects ุจุฏูุงู ูู PostgreSQL date arithmetic

**ุงูุดุฑุญ**:
- JavaScript Date objects ุชุชุฃุซุฑ ุจู timezone
- ุงูุชุญููู ุจูู timezones ูุฏ ูุณุจุจ ุฃุฎุทุงุก
- PostgreSQL INTERVAL ุฃูุซุฑ ุฏูุฉ ูููุซูููุฉ

**ุงูุนูุงูุฉ**: ูุคุซุฑ ุนูู ุฌููุน ุงูุชูุงุฑูุฑ ุงูุชู ุชุนุชูุฏ ุนูู Business Day

### 4.2 C-002: ุชูุฑุงุฑ ุงูุญุณุงุจุงุช

**ุงูุณุจุจ ุงูุฌุฐุฑู**: ุนุฏู ูุฌูุฏ UNIQUE constraint ุนูู account_code

**ุงูุดุฑุญ**:
- ุงูุจูุงูุงุช ุงููุฏููุฉ ูุฏ ุชุญุชูู ุนูู ุชูุฑุงุฑ
- ุนุฏู ูุฌูุฏ validation ุนูุฏ ุงูุฅุฏุฎุงู
- ุนุฏู ูุฌูุฏ migration script ููุชูุธูู

**ุงูุนูุงูุฉ**: ูุคุซุฑ ุนูู ุฌููุน ุงูุชูุงุฑูุฑ ุงููุงููุฉ ูุงูููุฒุงููุงุช

### 4.3 C-003: API Contract

**ุงูุณุจุจ ุงูุฌุฐุฑู**: ุนุฏู ูุฌูุฏ ุนูููุฉ ููุญุฏุฉ ูุชูุซูู ุงูู endpoints

**ุงูุดุฑุญ**:
- ุงูู endpoints ุชูุถุงู ุจุฏูู ุชูุซูู
- ุนุฏู ูุฌูุฏ ูุฑุงุฌุนุฉ ุฏูุฑูุฉ
- ุนุฏู ูุฌูุฏ ุขููุฉ ููุชุญูู ูู ุงูุชุทุงุจู

**ุงูุนูุงูุฉ**: ูุคุซุฑ ุนูู ูุงุจููุฉ ุงูุตูุงูุฉ ูุงูููุซูููุฉ

### 4.4 M-001: ุงุฒุฏูุงุฌูุฉ ุงููุณุงุฑุงุช

**ุงูุณุจุจ ุงูุฌุฐุฑู**: ุนุฏู ูุฌูุฏ ูุนุงููุฑ ููุญุฏุฉ ูุชุณููุฉ ุงูู endpoints

**ุงูุดุฑุญ**:
- ุชุทููุฑ ุชุฏุฑูุฌู ุจุฏูู ูุนุงููุฑ
- ุนุฏู ูุฌูุฏ code review
- ุนุฏู ูุฌูุฏ documentation

**ุงูุนูุงูุฉ**: ูุคุซุฑ ุนูู ูุงุจููุฉ ุงูุตูุงูุฉ ูุงูููู

---

## 5. ุฎุทุฉ ุงูุฅุตูุงุญ ุงููุชูุงููุฉ

### 5.1 ุงููุฑุญูุฉ 1: ุงูุฅุตูุงุญุงุช ุงูุญุฑุฌุฉ (ููุชููุฉ) โ

#### โ C-001: ุฅุตูุงุญ Business Day Logic
**ุงูุญุงูุฉ**: ููุชูู  
**ุงูุชูููุฐ**: ุงุณุชุฎุฏุงู PostgreSQL INTERVAL ูู ุฌููุน ุงูุงุณุชุนูุงูุงุช

#### โ C-002: ุฅุตูุงุญ ุชูุฑุงุฑ ุงูุญุณุงุจุงุช
**ุงูุญุงูุฉ**: ููุชูู  
**ุงูุชูููุฐ**: ุฅุถุงูุฉ UNIQUE constraints ุนูู account_code ู account_number

#### โ C-003: ุฅุตูุงุญ API Contract
**ุงูุญุงูุฉ**: ููุชูู  
**ุงูุชูููุฐ**: ุฅุถุงูุฉ ุฌููุน ุงูู endpoints ุงูููููุฏุฉ ุฅูู API_ENDPOINTS

#### โ C-004: ุฅุตูุงุญ POS Tables Schema
**ุงูุญุงูุฉ**: ููุชูู  
**ุงูุชูููุฐ**: ุฅุถุงูุฉ updated_at column ุชููุงุฆูุงู ุนูุฏ ุจุฏุก ุงูุณูุฑูุฑ

### 5.2 ุงููุฑุญูุฉ 2: ุงูุฅุตูุงุญุงุช ุงููุชูุณุทุฉ (ููุฏ ุงูุชูููุฐ) ๐

#### M-001: ุชูุญูุฏ ุฃุณูุงุก ุงููุณุงุฑุงุช
**ุงูุฃููููุฉ**: ุนุงููุฉ  
**ุงูุฎุทูุงุช**:
1. ุงุฎุชูุงุฑ ูุนูุงุฑ ููุญุฏ (RESTful kebab-case)
2. ุฅูุดุงุก mapping ููู aliases ุงููุฏููุฉ
3. ุชุญุฏูุซ Frontend ุชุฏุฑูุฌูุงู
4. ุฅุฒุงูุฉ ุงูู aliases ุจุนุฏ ุงูุชุฃูุฏ

**ุงูุชูุฏูุฑ**: 2-3 ุณุงุนุงุช

#### M-002: ุชูุญูุฏ RESTful naming
**ุงูุฃููููุฉ**: ูุชูุณุทุฉ  
**ุงูุฎุทูุงุช**:
1. ุชูุซูู ุงููุนุงููุฑ ุงููุทููุจุฉ
2. ูุฑุงุฌุนุฉ ุฌููุน ุงูู endpoints
3. ุชุญุฏูุซ ุชุฏุฑูุฌู
4. ุงุฎุชุจุงุฑ ุดุงูู

**ุงูุชูุฏูุฑ**: 4-6 ุณุงุนุงุช

#### M-003: ุชูุญูุฏ Prisma Schema
**ุงูุฃููููุฉ**: ูุชูุณุทุฉ  
**ุงูุฎุทูุงุช**:
1. ูุฑุงุฌุนุฉ ุงูุฌุฏุงูู ุงููุนููุฉ
2. ุชุญุฏูุซ Prisma schema
3. ุฅูุดุงุก migration script
4. ุงุฎุชุจุงุฑ ุดุงูู

**ุงูุชูุฏูุฑ**: 3-4 ุณุงุนุงุช

#### M-004: ุชุญุฏูุซ ุงููููุฏ ุงููุฏููุฉ
**ุงูุฃููููุฉ**: ููุฎูุถุฉ  
**ุงูุฎุทูุงุช**:
1. ุชุญุฏูุฏ ุงููููุฏ ุจุฏูู branch
2. ุฅูุดุงุก migration script
3. ุชุญุฏูุซ ุงูุจูุงูุงุช
4. ุงูุชุญูู ูู ุงููุชุงุฆุฌ

**ุงูุชูุฏูุฑ**: 1-2 ุณุงุนุฉ

### 5.3 ุงููุฑุญูุฉ 3: ุงูุชุญุณููุงุช (ูุณุชูุจููุฉ) ๐

#### L-001: ุชุญุณูู Logging
**ุงูุฃููููุฉ**: ููุฎูุถุฉ  
**ุงูุฎุทูุงุช**:
1. ุงุณุชุฎุฏุงู logging library (winston/pino)
2. ุฅุฒุงูุฉ console.log ูู Production
3. ุฅุถุงูุฉ log levels
4. ุฅุถุงูุฉ log rotation

**ุงูุชูุฏูุฑ**: 2-3 ุณุงุนุงุช

#### L-002: ุฅุถุงูุฉ Error Boundaries
**ุงูุฃููููุฉ**: ูุชูุณุทุฉ  
**ุงูุฎุทูุงุช**:
1. ูุฑุงุฌุนุฉ ุฌููุน ุงูููููุงุช
2. ุฅุถุงูุฉ Error Boundaries
3. ุชุญุณูู error messages
4. ุงุฎุชุจุงุฑ ุดุงูู

**ุงูุชูุฏูุฑ**: 2-3 ุณุงุนุงุช

#### L-003: ุฅุถุงูุฉ Unit Tests
**ุงูุฃููููุฉ**: ุนุงููุฉ (ููู ุทูููุฉ ุงูุฃูุฏ)  
**ุงูุฎุทูุงุช**:
1. ุฅุนุฏุงุฏ testing framework
2. ูุชุงุจุฉ tests ูููุธุงุฆู ุงูุญุฑุฌุฉ
3. ุฅุถุงูุฉ CI/CD ููู tests
4. ุฒูุงุฏุฉ coverage ุชุฏุฑูุฌูุงู

**ุงูุชูุฏูุฑ**: 20-30 ุณุงุนุฉ

---

## 6. ุฎุทูุงุช ุงูุชูููุฐ

### 6.1 ุงูุชุญุถูุฑ

```bash
# 1. ูุณุฎ ุงุญุชูุงุทู ูููุงุนุฏุฉ ุงูุจูุงูุงุช
pg_dump -h <host> -U <user> -d <database> > backup_$(date +%Y%m%d).sql

# 2. ูุณุฎ ุงุญุชูุงุทู ููููุฏ
git checkout -b fixes/$(date +%Y%m%d)
git add .
git commit -m "Backup before fixes"
```

### 6.2 ุชูููุฐ ุงูุฅุตูุงุญุงุช ุงูุญุฑุฌุฉ (ููุชูู) โ

ุฌููุน ุงูุฅุตูุงุญุงุช ุงูุญุฑุฌุฉ ุชู ุชูููุฐูุง ูู ุงูููุฏ ุงูุญุงูู.

### 6.3 ุชูููุฐ ุงูุฅุตูุงุญุงุช ุงููุชูุณุทุฉ

#### M-001: ุชูุญูุฏ ุฃุณูุงุก ุงููุณุงุฑุงุช

**ุงูุฎุทูุฉ 1**: ุฅูุดุงุก mapping file
```javascript
// backend/utils/route-aliases.js
export const ROUTE_ALIASES = {
  '/api/pos/issueInvoice': '/api/pos/issue-invoice',
  '/api/pos/saveDraft': '/api/pos/save-draft',
  '/api/settings/settings_company': '/api/settings/company',
};
```

**ุงูุฎุทูุฉ 2**: ุฅุถุงูุฉ middleware ููุชุญููู
```javascript
// ูู server.js
app.use((req, res, next) => {
  if (ROUTE_ALIASES[req.path]) {
    req.url = ROUTE_ALIASES[req.path] + (req.url.split('?')[1] ? '?' + req.url.split('?')[1] : '');
  }
  next();
});
```

**ุงูุฎุทูุฉ 3**: ุชุญุฏูุซ Frontend ุชุฏุฑูุฌูุงู
- ุชุญุฏูุซ `frontend/src/services/api/index.js`
- ุงุฎุชุจุงุฑ ูู endpoint ุจุนุฏ ุงูุชุญุฏูุซ

#### M-002: ุชูุญูุฏ RESTful naming

**ุงูุฎุทูุฉ 1**: ุชูุซูู ุงููุนุงููุฑ
```markdown
# API Naming Standards
- Use kebab-case for all endpoints
- Use plural nouns for resources
- Use verbs for actions: /api/resource/action
- Examples:
  - โ /api/pos/issue-invoice
  - โ /api/orders/:id
  - โ /api/pos/issueInvoice
```

**ุงูุฎุทูุฉ 2**: ูุฑุงุฌุนุฉ ุฌููุน ุงูู endpoints
- ุฅูุดุงุก ูุงุฆูุฉ ุจุฌููุน ุงูู endpoints
- ุชุญุฏูุฏ ุงูู endpoints ุงูุชู ุชุญุชุงุฌ ุชุญุฏูุซ
- ุชุฑุชูุจ ุญุณุจ ุงูุฃููููุฉ

**ุงูุฎุทูุฉ 3**: ุชุญุฏูุซ ุชุฏุฑูุฌู
- ุชุญุฏูุซ endpoint ูุงุญุฏ ูู ูู ูุฑุฉ
- ุงุฎุชุจุงุฑ ุดุงูู ุจุนุฏ ูู ุชุญุฏูุซ
- ุชูุซูู ุงูุชุบููุฑุงุช

#### M-003: ุชูุญูุฏ Prisma Schema

**ุงูุฎุทูุฉ 1**: ูุฑุงุฌุนุฉ ุงูุฌุฏุงูู ุงููุนููุฉ
```sql
-- ุงูุญุตูู ุนูู ูุงุฆูุฉ ุจุฌููุน ุงูุฌุฏุงูู
SELECT table_name 
FROM information_schema.tables 
WHERE table_schema = 'public';

-- ุงูุญุตูู ุนูู structure ููู ุฌุฏูู
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_name = 'accounts';
```

**ุงูุฎุทูุฉ 2**: ุชุญุฏูุซ Prisma schema
- ุฅุถุงูุฉ ุงูุฌุฏุงูู ุงูููููุฏุฉ
- ุชุญุฏูุซ ุงูุฃุนูุฏุฉ
- ุฅุถุงูุฉ ุงูุนูุงูุงุช

**ุงูุฎุทูุฉ 3**: ุฅูุดุงุก migration
```bash
npx prisma migrate dev --name sync_schema
```

#### M-004: ุชุญุฏูุซ ุงููููุฏ ุงููุฏููุฉ

**ุงูุฎุทูุฉ 1**: ุชุญุฏูุฏ ุงููููุฏ ุจุฏูู branch
```sql
SELECT id, date, reference_type, reference_id, branch
FROM journal_entries
WHERE branch IS NULL
ORDER BY date DESC;
```

**ุงูุฎุทูุฉ 2**: ุฅูุดุงุก migration script
```javascript
// backend/scripts/add_branch_to_old_entries.js
// ุงุณุชุฎุฑุงุฌ branch ูู invoices ุฃู orders ุงููุฑุชุจุทุฉ
```

**ุงูุฎุทูุฉ 3**: ุชูููุฐ ุงูุชุญุฏูุซ
```bash
node backend/scripts/add_branch_to_old_entries.js
```

---

## 7. ุฎุทุฉ ุงูุงุฎุชุจุงุฑ

### 7.1 ุงุฎุชุจุงุฑ ุงููุญุฏุงุช (Unit Tests)

#### T-001: ุงุฎุชุจุงุฑ Business Day Logic
```javascript
describe('Business Day Calculation', () => {
  it('should calculate correct start time (09:00 AM)', () => {
    const date = '2026-01-19';
    const start = calculateBusinessDayStart(date);
    expect(start).toBe('2026-01-19 09:00:00');
  });
  
  it('should calculate correct end time (02:00 AM next day)', () => {
    const date = '2026-01-19';
    const end = calculateBusinessDayEnd(date);
    expect(end).toBe('2026-01-20 02:00:00');
  });
});
```

#### T-002: ุงุฎุชุจุงุฑ API Contract
```javascript
describe('API Contract Validation', () => {
  it('should recognize all registered endpoints', () => {
    const endpoints = ['/api/pos/issue-invoice', '/api/orders/123'];
    endpoints.forEach(endpoint => {
      expect(API_ENDPOINTS.has(normalizePath(endpoint))).toBe(true);
    });
  });
});
```

### 7.2 ุงุฎุชุจุงุฑ ุงูุชูุงูู (Integration Tests)

#### T-003: ุงุฎุชุจุงุฑ ุฅูุดุงุก ุงููุงุชูุฑุฉ ูุน ุงูููุฏ ุงููุญุงุณุจู
```javascript
describe('Invoice Creation with Journal Entry', () => {
  it('should create journal entry when invoice is created', async () => {
    const invoice = await createInvoice({...});
    const journalEntry = await getJournalEntryByInvoiceId(invoice.id);
    expect(journalEntry).toBeDefined();
    expect(journalEntry.status).toBe('posted');
    expect(journalEntry.reference_type).toBe('invoice');
  });
});
```

#### T-004: ุงุฎุชุจุงุฑ ุชูุฑูุฑ Business Day Sales
```javascript
describe('Business Day Sales Report', () => {
  it('should return correct data for business day', async () => {
    // ุฅูุดุงุก ูููุฏ ูุญุงุณุจูุฉ ูู business day
    await createJournalEntry({date: '2026-01-19 10:00:00', ...});
    
    // ุทูุจ ุงูุชูุฑูุฑ
    const report = await getBusinessDaySales('2026-01-19', 'china_town');
    
    expect(report.invoices.length).toBeGreaterThan(0);
    expect(report.summary.total_sales).toBeGreaterThan(0);
  });
});
```

### 7.3 ุงุฎุชุจุงุฑ ุงูุฃุฏุงุก (Performance Tests)

#### T-005: ุงุฎุชุจุงุฑ ุณุฑุนุฉ ุงูุงุณุชุนูุงูุงุช
```javascript
describe('Query Performance', () => {
  it('should complete business day sales query in < 1 second', async () => {
    const start = Date.now();
    await getBusinessDaySales('2026-01-19', 'china_town');
    const duration = Date.now() - start;
    expect(duration).toBeLessThan(1000);
  });
});
```

### 7.4 ุงุฎุชุจุงุฑ ุงูุฃูุงู (Security Tests)

#### T-006: ุงุฎุชุจุงุฑ ุงููุตุงุฏูุฉ ูุงูุตูุงุญูุงุช
```javascript
describe('Authentication & Authorization', () => {
  it('should reject unauthorized requests', async () => {
    const response = await request(app)
      .get('/api/orders')
      .expect(401);
  });
  
  it('should allow authorized requests', async () => {
    const token = await getAuthToken();
    const response = await request(app)
      .get('/api/orders')
      .set('Authorization', `Bearer ${token}`)
      .expect(200);
  });
});
```

---

## 8. ุงูุชูุฑูุฑ ุงูููุงุฆู

### 8.1 ููุฎุต ุงูุฅุตูุงุญุงุช ุงููุทุจูุฉ โ

1. **Business Day Logic**: ุชู ุงูุฅุตูุงุญ ุจุงุณุชุฎุฏุงู PostgreSQL INTERVAL
2. **ุชูุฑุงุฑ ุงูุญุณุงุจุงุช**: ุชู ุงูุฅุตูุงุญ ุจุฅุถุงูุฉ UNIQUE constraints
3. **API Contract**: ุชู ุงูุฅุตูุงุญ ุจุฅุถุงูุฉ ุฌููุน ุงูู endpoints
4. **POS Tables Schema**: ุชู ุงูุฅุตูุงุญ ุจุฅุถุงูุฉ updated_at column

### 8.2 ุงูุฅุตูุงุญุงุช ุงููุชุจููุฉ โ๏ธ

1. **ุชูุญูุฏ ุฃุณูุงุก ุงููุณุงุฑุงุช**: ูุญุชุงุฌ ูุฑุงุฑ ูุชูููุฐ
2. **ุชูุญูุฏ RESTful naming**: ูุญุชุงุฌ ูุฑุงุฌุนุฉ ุดุงููุฉ
3. **ุชูุญูุฏ Prisma Schema**: ูุญุชุงุฌ sync ูุน ุงูุฌุฏุงูู ุงููุนููุฉ
4. **ุชุญุฏูุซ ุงููููุฏ ุงููุฏููุฉ**: ูุญุชุงุฌ migration script

### 8.3 ุงูุชูุตูุงุช ููุชุญุณูู ุงููุณุชูุจูู ๐

1. **ุฅุถุงูุฉ Unit Tests**: ูููุธุงุฆู ุงูุญุฑุฌุฉ
2. **ุชุญุณูู Logging**: ุงุณุชุฎุฏุงู logging library
3. **ุฅุถุงูุฉ Error Boundaries**: ูู ุฌููุน ุงูููููุงุช
4. **ุชูุซูู API**: ุงุณุชุฎุฏุงู Swagger/OpenAPI
5. **Code Review Process**: ูุจู merge ุฃู ุชุบููุฑุงุช
6. **CI/CD Pipeline**: ููุงุฎุชุจุงุฑ ุงูุชููุงุฆู

### 8.4 ุฎุทุฉ ุงูุตูุงูุฉ ุงูุฏูุฑูุฉ ๐

#### ุฃุณุจูุนูุงู:
- ูุฑุงุฌุนุฉ Logs ููุฃุฎุทุงุก
- ูุฑุงุฌุนุฉ Performance metrics
- ุงูุชุญูู ูู Database backups

#### ุดูุฑูุงู:
- ูุฑุงุฌุนุฉ API Contract
- ูุฑุงุฌุนุฉ Security updates
- ูุฑุงุฌุนุฉ Dependencies updates

#### ุฑุจุน ุณูููุงู:
- ูุฑุงุฌุนุฉ ุดุงููุฉ ููููุฏ
- ุชุญุฏูุซ Documentation
- ูุฑุงุฌุนุฉ Architecture

---

## 9. ุงูุฎูุงุตุฉ

ุชู ุฅุตูุงุญ ุฌููุน ุงููุดุงูู ุงูุญุฑุฌุฉ ูู ุงููุธุงู. ุงููุธุงู ุงูุขู:
- โ ูุนูู ุจุดูู ุตุญูุญ ูุญุงุณุจูุงู
- โ ุงูุชูุงุฑูุฑ ุชุนูู ุจุดูู ุตุญูุญ
- โ API Contract ููุญุฏ
- โ Schema ูุญุฏุซ

ุงููุดุงูู ุงููุชุจููุฉ ูู ุชุญุณููุงุช ูููุณุช ุฃุฎุทุงุก ุญุฑุฌุฉุ ููููู ุงูุชุนุงูู ูุนูุง ุชุฏุฑูุฌูุงู.

---

**ุชู ุฅุนุฏุงุฏ ุงูุชูุฑูุฑ ุจูุงุณุทุฉ**: AI Assistant  
**ุงูุชุงุฑูุฎ**: 2026-01-19  
**ุงูุญุงูุฉ**: ุฌุงูุฒ ููุชูููุฐ โ
