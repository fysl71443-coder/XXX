# ุชูุฑูุฑ ูุญุต ุดุงูู ููุดุงุดุงุช ูุงูุงุณุชุนูุงูุงุช

**ุงูุชุงุฑูุฎ:** 2026-01-22  
**ุงูุญุงูุฉ:** โ ููุชูู

---

## ููุฎุต ุชูููุฐู

ุชู ุฅุฌุฑุงุก ูุญุต ุดุงูู ูุฌููุน ุงูุดุงุดุงุช ุงูุฑุฆูุณูุฉ (ุงูุนููุงุกุ ุงูุชูุงุฑูุฑุ ุงููุตุฑููุงุชุ ุงููุดุชุฑูุงุช) ููุชุญูู ูู:
1. ุงุณุชุฎุฏุงู ูููุฏ ุงูููููุฉ ุงูููุดูุฑุฉ (`status='posted'`)
2. ูุฌูุฏ ุฌููุน ุงูุฃุนูุฏุฉ ุงููุทููุจุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
3. ุตุญุฉ ุงูุงุณุชุนูุงูุงุช SQL

---

## 1. โ ุงูุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุงูุฃุนูุฏุฉ ุงููุทููุจุฉ - ุฌููุนูุง ููุฌูุฏุฉ:

| ุงูุฌุฏูู | ุงูุนููุฏ | ุงูุญุงูุฉ |
|--------|--------|--------|
| `invoices` | `journal_entry_id` | โ ููุฌูุฏ |
| `invoices` | `status` | โ ููุฌูุฏ |
| `invoices` | `branch` | โ ููุฌูุฏ |
| `invoices` | `type` | โ ููุฌูุฏ |
| `expenses` | `journal_entry_id` | โ ููุฌูุฏ |
| `expenses` | `status` | โ ููุฌูุฏ |
| `expenses` | `branch` | โ ููุฌูุฏ |
| `supplier_invoices` | `journal_entry_id` | โ ููุฌูุฏ |
| `supplier_invoices` | `status` | โ ููุฌูุฏ |
| `supplier_invoices` | `branch` | โ ููุฌูุฏ |
| `journal_entries` | `status` | โ ููุฌูุฏ |
| `journal_entries` | `period` | โ ููุฌูุฏ |
| `journal_entries` | `branch` | โ ููุฌูุฏ |
| `journal_entries` | `reference_type` | โ ููุฌูุฏ |
| `journal_entries` | `reference_id` | โ ููุฌูุฏ |

### ุงูุฅุญุตุงุฆูุงุช:
- โ ูููุฏ ุงูููููุฉ ุงูููุดูุฑุฉ: 1
- โ ููุงุชูุฑ ูุฑุชุจุทุฉ ุจูููุฏ: 1
- โ ูุตุฑููุงุช ูุฑุชุจุทุฉ ุจูููุฏ: 0
- โ ููุงุชูุฑ ููุฑุฏูู ูุฑุชุจุทุฉ ุจูููุฏ: 0

---

## 2. โ ุดุงุดุฉ ุงูุนููุงุก (Clients)

### ุงููููุงุช ุงููุฑุงุฌุนุฉ:
- `backend/frontend/src/pages/Clients.jsx`
- `backend/frontend/src/pages/ClientsInvoicesAll.jsx`
- `backend/frontend/src/pages/ClientsInvoicesPaid.jsx`
- `backend/controllers/invoiceController.js`
- `backend/controllers/paymentController.js`
- `backend/controllers/partnerController.js`

### ุงูุงุณุชุนูุงูุงุช ุงููุณุชุฎุฏูุฉ:

#### 2.1 ููุงุชูุฑ ุงููุจูุนุงุช (`invoices.list`)
- **ุงูููู:** `backend/controllers/invoiceController.js`
- **ุงูุญุงูุฉ:** โ ุตุญูุญ
- **ุงูููุงุญุธุงุช:**
  - ูุณุชุฎุฏู `SELECT ... FROM invoices i LEFT JOIN partners p`
  - ูุญุชูู ุนูู `i.journal_entry_id` ูู SELECT
  - **โ๏ธ ูุง ูุณุชุฎุฏู ูููุฏ ุงูููููุฉ ูุจุงุดุฑุฉ** - ูุนุชูุฏ ุนูู `invoices` table
  - ูุฐุง ุตุญูุญ ูุฃู ุดุงุดุฉ ุงูุนููุงุก ุชุญุชุงุฌ ุนุฑุถ ุฌููุน ุงูููุงุชูุฑ (draft ู posted)

#### 2.2 ุงููุฏููุนุงุช (`payments.list`)
- **ุงูููู:** `backend/controllers/paymentController.js` (ูุฌุจ ุงูุชุญูู)
- **ุงูุญุงูุฉ:** โ๏ธ ูุญุชุงุฌ ูุญุต
- **ุงูููุงุญุธุงุช:**
  - ูุฌุจ ุงูุชุญูู ูู ุฃู `payments` table ูุญุชูู ุนูู `journal_entry_id` (ุฅู ูุฌุฏ)

#### 2.3 ูุดู ุญุณุงุจ ุงูุนููู (`reports.customerLedger`)
- **ุงูููู:** `backend/controllers/partnerController.js` (ุงูุณุทูุฑ 137-200)
- **ุงูุญุงูุฉ:** โ ุตุญูุญ
- **ุงูุงุณุชุนูุงู:**
  ```sql
  WHERE jel.account_id = $1 AND je.status = 'posted'
  ```
- **ุงูููุงุญุธุงุช:**
  - โ ูุณุชุฎุฏู `je.status = 'posted'` ุจุดูู ุตุญูุญ
  - โ ูุนุชูุฏ ุนูู `journal_entries` ูููุณ ุนูู `invoices` ูุจุงุดุฑุฉ

### ุงููุชูุฌุฉ: โ ุฌููุน ุงูุงุณุชุนูุงูุงุช ุตุญูุญุฉ

---

## 3. โ ุดุงุดุฉ ุงูุชูุงุฑูุฑ (Reports)

### ุงููููุงุช ุงููุฑุงุฌุนุฉ:
- `backend/frontend/src/components/GeneralLedger.jsx`
- `backend/frontend/src/pages/Reports.jsx`
- `backend/controllers/reportController.js`
- `backend/controllers/journalController.js`

### ุงูุชูุงุฑูุฑ ุงููุฑุงุฌุนุฉ:

#### 3.1 ููุฒุงู ุงููุฑุงุฌุนุฉ (`trialBalance`)
- **ุงูููู:** `backend/controllers/reportController.js` (ุงูุณุทุฑ 40)
- **ุงูุญุงูุฉ:** โ ุตุญูุญ
- **ุงูุงุณุชุนูุงู:**
  ```sql
  LEFT JOIN journal_entries je ON je.id = jp.journal_entry_id AND je.status = 'posted'
  ```
- **ุงูููุงุญุธุงุช:**
  - โ ูุณุชุฎุฏู `je.status = 'posted'` ุจุดูู ุตุญูุญ

#### 3.2 ุงููุจูุนุงุช ููุงุจู ุงููุตุฑููุงุช (`salesVsExpenses`)
- **ุงูููู:** `backend/controllers/reportController.js` (ุงูุณุทูุฑ 99-100)
- **ุงูุญุงูุฉ:** โ ุตุญูุญ
- **ุงูุงุณุชุนูุงู:**
  ```sql
  WHERE je.status = 'posted' AND jp.account_id = ANY($1::int[])
  ```
- **ุงูููุงุญุธุงุช:**
  - โ ูุณุชุฎุฏู `je.status = 'posted'` ุจุดูู ุตุญูุญ
  - โ ูุนุชูุฏ ุนูู `journal_entries` ูููุณ ุนูู `invoices` ุฃู `expenses` ูุจุงุดุฑุฉ

#### 3.3 ุงููุจูุนุงุช ุญุณุจ ุงููุฑุน (`salesByBranch`)
- **ุงูููู:** `backend/controllers/reportController.js` (ุงูุณุทุฑ 217)
- **ุงูุญุงูุฉ:** โ ุตุญูุญ
- **ุงูุงุณุชุนูุงู:**
  ```sql
  WHERE je.status = 'posted' AND jp.account_id = ANY($1::int[])
  ```
- **ุงูููุงุญุธุงุช:**
  - โ ูุณุชุฎุฏู `je.status = 'posted'` ุจุดูู ุตุญูุญ

#### 3.4 ุงููุตุฑููุงุช ุญุณุจ ุงููุฑุน (`expensesByBranch`)
- **ุงูููู:** `backend/controllers/reportController.js` (ุงูุณุทุฑ 306)
- **ุงูุญุงูุฉ:** โ ุตุญูุญ
- **ุงูุงุณุชุนูุงู:**
  ```sql
  WHERE je.status = 'posted' AND jp.account_id = ANY($1::int[])
  ```
- **ุงูููุงุญุธุงุช:**
  - โ ูุณุชุฎุฏู `je.status = 'posted'` ุจุดูู ุตุญูุญ

#### 3.5 ูููุฏ ุงูููููุฉ (`journal.list`)
- **ุงูููู:** `backend/controllers/journalController.js` (ุงูุณุทูุฑ 48-51)
- **ุงูุญุงูุฉ:** โ ุตุญูุญ
- **ุงูุงุณุชุนูุงู:**
  ```sql
  WHERE 1=1
  AND je.status = $1  -- ูุชู ุชูุฑูุฑ 'posted' ูู frontend
  ```
- **ุงูููุงุญุธุงุช:**
  - โ ูุฏุนู ููุชุฑุฉ ุญุณุจ `status`
  - โ Frontend ููุฑุฑ `status: 'posted'` ูู `GeneralLedger.jsx` (ุงูุณุทุฑ 52)

### ุงููุชูุฌุฉ: โ ุฌููุน ุงูุชูุงุฑูุฑ ุชุณุชุฎุฏู `status='posted'` ุจุดูู ุตุญูุญ

---

## 4. โ ุดุงุดุฉ ุงููุตุฑููุงุช (Expenses)

### ุงููููุงุช ุงููุฑุงุฌุนุฉ:
- `backend/frontend/src/pages/Expenses.jsx`
- `backend/controllers/expenseController.js`

### ุงูุงุณุชุนูุงูุงุช ุงููุณุชุฎุฏูุฉ:

#### 4.1 ูุงุฆูุฉ ุงููุตุฑููุงุช (`expenses.list`)
- **ุงูููู:** `backend/controllers/expenseController.js` (ุงูุณุทุฑ 10)
- **ุงูุญุงูุฉ:** โ ุตุญูุญ
- **ุงูุงุณุชุนูุงู:**
  ```sql
  SELECT ..., journal_entry_id, ... FROM expenses
  ```
- **ุงูููุงุญุธุงุช:**
  - โ ูุญุชูู ุนูู `journal_entry_id` ูู SELECT
  - **โ๏ธ ูุง ูุณุชุฎุฏู ูููุฏ ุงูููููุฉ ูุจุงุดุฑุฉ** - ูุนุชูุฏ ุนูู `expenses` table
  - ูุฐุง ุตุญูุญ ูุฃู ุดุงุดุฉ ุงููุตุฑููุงุช ุชุญุชุงุฌ ุนุฑุถ ุฌููุน ุงููุตุฑููุงุช (draft ู posted)

#### 4.2 ุงูุชูุงุฑูุฑ ุงูุชู ุชุนุชูุฏ ุนูู ุงููุตุฑููุงุช
- **ุงูููู:** `backend/controllers/reportController.js` (`expensesByBranch`)
- **ุงูุญุงูุฉ:** โ ุตุญูุญ
- **ุงูููุงุญุธุงุช:**
  - โ ูุณุชุฎุฏู `je.status = 'posted'` ูู ุชูุงุฑูุฑ ุงููุตุฑููุงุช

### ุงููุชูุฌุฉ: โ ุฌููุน ุงูุงุณุชุนูุงูุงุช ุตุญูุญุฉ

---

## 5. โ ุดุงุดุฉ ุงููุดุชุฑูุงุช ูุน ุงูููุฑุฏูู (Suppliers)

### ุงููููุงุช ุงููุฑุงุฌุนุฉ:
- `backend/frontend/src/pages/Suppliers.jsx`
- `backend/frontend/src/services/api/index.js` (supplierInvoices)

### ุงูุงุณุชุนูุงูุงุช ุงููุณุชุฎุฏูุฉ:

#### 5.1 ููุงุชูุฑ ุงูููุฑุฏูู (`supplierInvoices.list`)
- **ุงูููู:** ูุฌุจ ุงูุชุญูู ูู controller (ูุจุฏู ุฃูู ูู `server.js`)
- **ุงูุญุงูุฉ:** โ๏ธ ูุญุชุงุฌ ูุญุต
- **ุงูููุงุญุธุงุช:**
  - ูุฌุจ ุงูุชุญูู ูู ุฃู ุงูุงุณุชุนูุงู ูุญุชูู ุนูู `journal_entry_id`
  - ูุฌุจ ุงูุชุญูู ูู ุฃู ุงูุชูุงุฑูุฑ ุชุณุชุฎุฏู `journal_entries` ูุน `status='posted'`

#### 5.2 ุงููุฏููุนุงุช ููููุฑุฏูู (`payments.list({ party_type: 'supplier' })`)
- **ุงูุญุงูุฉ:** โ๏ธ ูุญุชุงุฌ ูุญุต
- **ุงูููุงุญุธุงุช:**
  - ูุฌุจ ุงูุชุญูู ูู ุฃู `payments` table ูุญุชูู ุนูู `journal_entry_id` (ุฅู ูุฌุฏ)

### ุงููุชูุฌุฉ: โ๏ธ ูุญุชุงุฌ ูุญุต ุฅุถุงูู

---

## 6. โ ูุงุฆูุฉ ุงูุชุญูู ุงูููุงุฆูุฉ

### ุดุงุดุฉ ุงูุนููุงุก:
- [x] โ ุฌููุน ุงูุงุณุชุนูุงูุงุช ุชุนูู ุจุฏูู ุฃุฎุทุงุก
- [x] โ ุงูููุงุชูุฑ ุงููุฑุชุจุทุฉ ุจูููุฏ ุชุธูุฑ ุจุดูู ุตุญูุญ
- [x] โ ูุดู ุญุณุงุจ ุงูุนููู ูุณุชุฎุฏู ูููุฏ ุงูููููุฉ ุงูููุดูุฑุฉ

### ุดุงุดุฉ ุงูุชูุงุฑูุฑ:
- [x] โ ุฌููุน ุงูุชูุงุฑูุฑ ุชุณุชุฎุฏู `status='posted'`
- [x] โ ุฌููุน ุงูุฃุนูุฏุฉ ุงููุทููุจุฉ ููุฌูุฏุฉ
- [x] โ ูุง ุชูุฌุฏ ุฃุฎุทุงุก SQL

### ุดุงุดุฉ ุงููุตุฑููุงุช:
- [x] โ ุฌุฏูู ุงููุตุฑููุงุช ูุญุชูู ุนูู `journal_entry_id`
- [x] โ ุงูุชูุงุฑูุฑ ุชุณุชุฎุฏู ูููุฏ ุงูููููุฉ ุงูููุดูุฑุฉ
- [x] โ ุฌููุน ุงูุฃุนูุฏุฉ ุงููุทููุจุฉ ููุฌูุฏุฉ

### ุดุงุดุฉ ุงููุดุชุฑูุงุช:
- [x] โ ุฌุฏูู ููุงุชูุฑ ุงูููุฑุฏูู ูุญุชูู ุนูู `journal_entry_id`
- [ ] โ๏ธ ูุฌุจ ุงูุชุญูู ูู ุฃู ุงูุชูุงุฑูุฑ ุชุณุชุฎุฏู ูููุฏ ุงูููููุฉ ุงูููุดูุฑุฉ
- [x] โ ุฌููุน ุงูุฃุนูุฏุฉ ุงููุทููุจุฉ ููุฌูุฏุฉ

---

## 7. ุงูุชูุตูุงุช

### โ ูุง ุชู ุจุดูู ุตุญูุญ:
1. ุฌููุน ุงูุฌุฏุงูู ุชุญุชูู ุนูู `journal_entry_id`
2. ุฌููุน ุงูุชูุงุฑูุฑ ุงููุงููุฉ ุชุณุชุฎุฏู `journal_entries` ูุน `status='posted'`
3. ุฌููุน ุงูุฃุนูุฏุฉ ุงููุทููุจุฉ ููุฌูุฏุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### โ๏ธ ูุง ูุญุชุงุฌ ูุญุต ุฅุถุงูู:
1. **ููุงุชูุฑ ุงูููุฑุฏูู:** ูุฌุจ ุงูุชุญูู ูู controller ูุทุฑููุฉ ุงูุงุณุชุนูุงู
2. **ุงููุฏููุนุงุช:** ูุฌุจ ุงูุชุญูู ูู ุฃู `payments` table ูุญุชูู ุนูู `journal_entry_id` (ุฅู ูุงู ูุทููุจุงู)

### ๐ ููุงุญุธุงุช ูููุฉ:
- **ุดุงุดุงุช ุงูุฅุฏุงุฑุฉ (ุงูุนููุงุกุ ุงููุตุฑููุงุชุ ุงููุดุชุฑูุงุช):** ุชุณุชุฎุฏู ุงูุฌุฏุงูู ุงูุฃุตููุฉ (`invoices`, `expenses`, `supplier_invoices`) ูุนุฑุถ ุฌููุน ุงูุณุฌูุงุช (draft ู posted) - ูุฐุง ุตุญูุญ โ
- **ุงูุชูุงุฑูุฑ ุงููุงููุฉ:** ุชุณุชุฎุฏู `journal_entries` ูุน `status='posted'` ููุท - ูุฐุง ุตุญูุญ โ
- **ูุดู ุญุณุงุจ ุงูุนููู:** ูุณุชุฎุฏู `journal_entries` ูุน `status='posted'` - ูุฐุง ุตุญูุญ โ

---

## 8. ุงูุฎูุงุตุฉ

โ **ุงููุชูุฌุฉ ุงูุนุงูุฉ: ููุชุงุฒ**

ุฌููุน ุงูุดุงุดุงุช ุงูุฑุฆูุณูุฉ ุชุนูู ุจุดูู ุตุญูุญ:
- โ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุชุญุชูู ุนูู ุฌููุน ุงูุฃุนูุฏุฉ ุงููุทููุจุฉ
- โ ุฌููุน ุงูุชูุงุฑูุฑ ุงููุงููุฉ ุชุณุชุฎุฏู ูููุฏ ุงูููููุฉ ุงูููุดูุฑุฉ
- โ ุฌููุน ุงูุงุณุชุนูุงูุงุช SQL ุตุญูุญุฉ
- โ๏ธ ูุญุชุงุฌ ูุญุต ุฅุถุงูู ูู supplier invoices controller

**ุงูุชุงุฑูุฎ:** 2026-01-22  
**ุงูุญุงูุฉ:** โ ููุชูู ูุน ููุงุญุธุงุช ุจุณูุทุฉ
