# ملخص الاختبارات E2E

## أنواع الاختبارات

### 1. الاختبارات الأساسية (`*-spec.js`)
**الهدف:** التحقق السريع من فتح الصفحات
- فتح الشاشة والتحقق من تحميلها
- التحقق من العناصر الأساسية
- **لا تقوم بعمليات حقيقية**

**الاستخدام:**
```bash
npm run test:playwright
```

### 2. الاختبارات الشاملة (`*-full.spec.js`)
**الهدف:** اختبار تدفق العمل مع التفاعلات
- فتح الصفحات
- اختبار الفلاتر والأزرار
- التحقق من البيانات المعروضة
- **لا تقوم بإنشاء/حذف بيانات حقيقية**

**الاستخدام:**
```bash
npm run test:playwright:full
```

### 3. الاختبارات الحقيقية (`*-full-real.spec.js`) ⭐⭐⭐
**الهدف:** اختبار تدفق العمل الكامل مع عمليات حقيقية
- ✅ **إنشاء سجلات حقيقية** في قاعدة البيانات
- ✅ **تنفيذ عمليات CRUD كاملة**
- ✅ **إصدار فواتير حقيقية**
- ✅ **نشر قيود محاسبية حقيقية**
- ✅ **تعديل وحذف السجلات**
- ✅ **التحقق من البيانات في قاعدة البيانات**
- ✅ **تنظيف تلقائي بعد الاختبار**

**الاستخدام:**
```bash
npm run test:playwright:real
```

## الاختبارات الحقيقية المتاحة

### 1. `02-accounting-full-real.spec.js`
**ما يتم تنفيذه:**
1. ✅ الحصول على حسابات من قاعدة البيانات
2. ✅ فتح نموذج إنشاء قيد
3. ✅ ملء بيانات القيد (تاريخ، وصف، مدين، دائن)
4. ✅ **حفظ المسودة** - التحقق من إنشائها في قاعدة البيانات
5. ✅ **نشر القيد** - تغيير الحالة إلى `posted`
6. ✅ **التحقق من التوازن** (Debit = Credit)
7. ✅ **التحقق من القيود** (2 قيود على الأقل)
8. ✅ **حذف القيد** بعد الاختبار

### 2. `05-employees-full-real.spec.js`
**ما يتم تنفيذه:**
1. ✅ فتح صفحة الإنشاء
2. ✅ **ملء جميع البيانات المطلوبة** (14 حقل)
3. ✅ **حفظ الموظف** - التحقق من إنشائه في قاعدة البيانات
4. ✅ **التحقق من البيانات المحفوظة** (الراتب، الاسم، إلخ)
5. ✅ **التحقق من الظهور** في القائمة
6. ✅ **تعديل الراتب** (5000 → 6000)
7. ✅ **التحقق من التعديل** في قاعدة البيانات
8. ✅ **حذف الموظف** بعد الاختبار

### 3. `06-pos-full-real.spec.js`
**ما يتم تنفيذه:**
1. ✅ الحصول على فرع ومنتج من قاعدة البيانات
2. ✅ فتح صفحة POS واختيار فرع
3. ✅ **إضافة منتج** للفاتورة - التحقق من ظهوره
4. ✅ **حفظ المسودة** - التحقق من إنشاء Order في قاعدة البيانات
5. ✅ **إصدار الفاتورة** مع طريقة دفع
6. ✅ **التحقق من إنشاء الفاتورة** في قاعدة البيانات
7. ✅ **اختبار زر الطباعة**
8. ✅ **حذف الفاتورة والطلب** بعد الاختبار

## التحسينات الأخيرة

### ✅ تحسينات POS:
- استخدام `window.__POS_TEST_SAVE__` و `window.__POS_TEST_ISSUE__`
- التحقق من إنشاء Order قبل إصدار الفاتورة
- انتظار أطول للعمليات (5 ثواني)
- التحقق من ظهور المنتج في قائمة الفاتورة

### ✅ تحسينات المحاسبة:
- اختيار الحسابات بشكل أفضل (بـ ID أو نص)
- التحقق من التوازن قبل الحفظ
- التحقق من إنشاء القيود (2 على الأقل)
- رسائل خطأ أوضح

### ✅ تحسينات الموظفين:
- ملء 14 حقل مع التحقق
- التحقق من البيانات المحفوظة (الراتب)
- رسائل خطأ أوضح عند الفشل
- انتظار أطول للعمليات

## النتائج المتوقعة

### وقت التنفيذ:
- **POS**: 15-30 ثانية (إضافة منتج، حفظ، إصدار فاتورة)
- **المحاسبة**: 20-40 ثانية (ملء قيد، حفظ، نشر)
- **الموظفين**: 30-60 ثانية (ملء 14 حقل، حفظ، تعديل، حذف)

### البيانات المُنشأة:
- ✅ Order في قاعدة البيانات
- ✅ Invoice في قاعدة البيانات
- ✅ Journal Entry في قاعدة البيانات
- ✅ Journal Postings (2 على الأقل)
- ✅ Employee في قاعدة البيانات

### التنظيف:
- ✅ جميع البيانات تُحذف تلقائياً بعد الاختبار
- ✅ حتى في حالة فشل الاختبار (في finally block)

## الاستخدام

```bash
# جميع الاختبارات الحقيقية
npm run test:playwright:real

# مع متصفح مرئي (للمراقبة)
npm run test:playwright:real:headed

# اختبار محدد
npx playwright test tests/05-employees-full-real.spec.js --headed
```

## التحذيرات

⚠️ **مهم جداً:**
- الاختبارات الحقيقية تقوم بإنشاء **بيانات حقيقية** في قاعدة البيانات
- **لا تشغل على قاعدة بيانات الإنتاج!**
- تأكد من وجود بيانات أساسية (حسابات، فروع، منتجات)
- تأكد من أن المستخدم admin لديه جميع الصلاحيات
