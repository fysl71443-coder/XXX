# الاختبارات الحقيقية - Real Workflow Tests

## الوصف
اختبارات E2E حقيقية تقوم بعمليات فعلية كاملة في النظام:
- ✅ إنشاء فواتير POS حقيقية مع منتجات ودفع
- ✅ إنشاء موظفين حقيقيين مع جميع البيانات
- ✅ إنشاء قيود محاسبية حقيقية ونشرها
- ✅ تعديل السجلات المُنشأة
- ✅ حذف السجلات المُنشأة
- ✅ التحقق من البيانات في قاعدة البيانات
- ✅ طباعة الفواتير

## الفرق بين الاختبارات

### الاختبارات الأساسية (`*-full.spec.js`)
- فتح الصفحات والتحقق من العناصر
- اختبار الفلاتر والأزرار
- التحقق من البيانات المعروضة

### الاختبارات الحقيقية (`*-full-real.spec.js`) ⭐
- **إنشاء سجلات حقيقية** في قاعدة البيانات
- **تنفيذ عمليات CRUD كاملة** (Create, Read, Update, Delete)
- **إصدار فواتير حقيقية** مع منتجات ودفع
- **نشر قيود محاسبية حقيقية**
- **تعديل وحذف السجلات المُنشأة**
- **التحقق من البيانات في قاعدة البيانات**

## الاختبارات الحقيقية المتاحة

### 1. `02-accounting-full-real.spec.js` - قيود محاسبية حقيقية

**ما يتم تنفيذه:**
1. ✅ الحصول على حسابات من قاعدة البيانات
2. ✅ فتح نموذج إنشاء قيد
3. ✅ ملء بيانات القيد (تاريخ، وصف، مدين، دائن)
4. ✅ **حفظ المسودة** في قاعدة البيانات
5. ✅ **نشر القيد** (Post) - تغيير الحالة إلى `posted`
6. ✅ **التحقق من التوازن** (Debit = Credit)
7. ✅ **حذف القيد** من قاعدة البيانات بعد الاختبار

**النتيجة:**
- قيد محاسبي حقيقي في قاعدة البيانات
- قيود منشورة متوازنة
- تنظيف تلقائي بعد الاختبار

### 2. `05-employees-full-real.spec.js` - موظفين حقيقيين

**ما يتم تنفيذه:**
1. ✅ فتح صفحة الإنشاء
2. ✅ **ملء جميع البيانات المطلوبة**:
   - الاسم الكامل
   - رقم الهوية (10 أرقام)
   - الجنسية
   - تاريخ الميلاد
   - الجنس
   - تاريخ التوظيف
   - نوع العقد
   - الراتب الأساسي
   - البدلات (سكن، نقل)
   - طريقة الدفع
   - رقم IBAN
3. ✅ **حفظ الموظف** في قاعدة البيانات
4. ✅ **التحقق من ظهوره** في القائمة
5. ✅ **تعديل الراتب** (من 5000 إلى 6000)
6. ✅ **التحقق من التعديل** في قاعدة البيانات
7. ✅ **حذف الموظف** من قاعدة البيانات بعد الاختبار

**النتيجة:**
- موظف حقيقي في قاعدة البيانات
- تعديل ناجح
- تنظيف تلقائي بعد الاختبار

### 3. `06-pos-full-real.spec.js` - فواتير POS حقيقية

**ما يتم تنفيذه:**
1. ✅ الحصول على فرع ومنتج من قاعدة البيانات
2. ✅ فتح صفحة POS واختيار فرع
3. ✅ **إضافة منتج** للفاتورة
4. ✅ **حفظ المسودة** (Order)
5. ✅ **إصدار الفاتورة** (Invoice) مع طريقة دفع
6. ✅ **التحقق من إنشاء الفاتورة** في قاعدة البيانات
7. ✅ **اختبار زر الطباعة**
8. ✅ **حذف الفاتورة والطلب** من قاعدة البيانات بعد الاختبار

**النتيجة:**
- طلب حقيقي في قاعدة البيانات
- فاتورة حقيقية في قاعدة البيانات
- تنظيف تلقائي بعد الاختبار

## الاستخدام

### تشغيل جميع الاختبارات الحقيقية:
```bash
npm run test:playwright:real
```

### تشغيل مع متصفح مرئي:
```bash
npm run test:playwright:real:headed
```

### تشغيل اختبار محدد:
```bash
npx playwright test tests/05-employees-full-real.spec.js
```

## التحذيرات

⚠️ **مهم جداً:**
- الاختبارات الحقيقية تقوم بإنشاء **بيانات حقيقية** في قاعدة البيانات
- يتم **حذف البيانات تلقائياً** بعد الاختبار
- في حالة فشل الاختبار، قد تبقى بيانات في قاعدة البيانات
- **لا تشغل هذه الاختبارات على قاعدة بيانات الإنتاج!**

## التنظيف

الاختبارات تقوم بتنظيف تلقائي:
- ✅ حذف الفواتير المُنشأة
- ✅ حذف الطلبات المُنشأة
- ✅ حذف الموظفين المُنشأة
- ✅ حذف القيود المُنشأة

## استكشاف الأخطاء

إذا فشل اختبار:
1. تحقق من أن قاعدة البيانات متاحة
2. تحقق من وجود بيانات أساسية (حسابات، فروع، منتجات)
3. تحقق من الصلاحيات (يجب أن يكون المستخدم admin)
4. راجع لقطة الشاشة المحفوظة
5. راجع تقرير HTML: `npx playwright show-report`

## البيانات المطلوبة

الاختبارات تحتاج:
- ✅ حساب admin نشط
- ✅ فرع واحد على الأقل
- ✅ منتج واحد على الأقل (للـ POS)
- ✅ حسابين محاسبين على الأقل (للقيد)

## مثال: تشغيل اختبار الموظفين

```bash
# تشغيل الاختبار
npm run test:playwright:real:headed

# سترى:
# 1. فتح صفحة الموظفين
# 2. فتح نموذج الإنشاء
# 3. ملء البيانات
# 4. حفظ الموظف
# 5. التحقق من ظهوره
# 6. تعديل الراتب
# 7. حذف الموظف
```

## الفوائد

✅ **اختبارات حقيقية** - تختبر النظام كما يستخدمه المستخدم الحقيقي
✅ **تحقق من قاعدة البيانات** - التأكد من أن البيانات محفوظة بشكل صحيح
✅ **اختبار CRUD كامل** - Create, Read, Update, Delete
✅ **تنظيف تلقائي** - لا تترك بيانات اختبار في قاعدة البيانات
