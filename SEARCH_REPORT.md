# تقرير البحث عن استدعاءات invoice_items

## الملفات المفحوصة:
1. ✅ `POSInvoice.jsx`
2. ✅ `POSTables.jsx`
3. ✅ `backend/frontend/src/services/api/index.js` (client/index.js)
4. ✅ `Suppliers.jsx`

## النتائج:

### 1. POSInvoice.jsx
- ❌ **لا يوجد استدعاء مباشر لـ `apiInvoices.items()` أو `invoices.items()`**
- ✅ توجد فقط **تعليقات تحذيرية** في:
  - السطر 755: في دالة `issueInvoice`
  - السطر 937: قبل دالة `issue()`
  - السطر 1019: بعد استدعاء `issueInvoice` للمبيعات النقدية
  - السطر 1164: في كود الطباعة للمبيعات النقدية
  - السطر 1259: بعد استدعاء `issueInvoice` للمبيعات الآجلة
  - السطر 1308: في كود الطباعة للمبيعات الآجلة

- ✅ الكود يستخدم `inv.lines` مباشرة من الـ response (السطور 1167-1195 و 1310-1339)

### 2. POSTables.jsx
- ✅ **لا يوجد استدعاءات لـ invoice_items**

### 3. api/index.js (client/index.js)
- ✅ **دالة `invoices.items()` موجودة وتُرمي خطأ عمدًا** (السطور 69-80)
- ✅ الخطأ يحتوي على رسالة واضحة بالعربية والإنجليزية
- ✅ الخطأ يحتوي على stack trace

### 4. Suppliers.jsx
- ✅ **يستخدم `invoices.get()` وليس `invoices.items()`** (السطور 485-490)
- ✅ يستخرج `lines` من الـ response مباشرة

## ملاحظات مهمة:

1. **الخطأ يحدث بعد `issueInvoice` مباشرة** - حسب logs المستخدم:
   ```
   GET http://localhost:5000/api/invoice_items/14 404 (Not Found)
   ```

2. **لا يوجد استدعاء مباشر مرئي** في الكود - مما يعني أن:
   - إما الاستدعاء موجود في مكان غير واضح (مثل callback مخفي)
   - أو هناك كود ديناميكي يستدعي الدالة
   - أو هناك useEffect يراقب تغييرات `invoiceId` ويستدعي الدالة تلقائيًا

3. **الحل المطبق** (دالة `items()` التي ترمي خطأ) سيكشف الموقع الدقيق عند حدوث الاستدعاء.

## الخطوات التالية الموصى بها:

1. ✅ **تم تطبيقها**: تعديل `invoices.items()` لترمي خطأ مع stack trace
2. ⏳ **في الانتظار**: تشغيل النظام ومحاولة إصدار فاتورة لرؤية stack trace الخطأ
3. ⏳ **بعد معرفة الموقع**: حذف السطر الذي يستدعي `apiInvoices.items()`

## ملفات أخرى قد تحتاج فحص:

- `backend/frontend/src/printing/index.js` - قد يستدعي items داخليًا
- أي ملفات أخرى تستورد `apiInvoices` وتستخدمه ديناميكيًا
