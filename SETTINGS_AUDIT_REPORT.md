# ุชูุฑูุฑ ูุฑุงุฌุนุฉ ุดุงููุฉ ูุดุงุดุฉ ุงูุฅุนุฏุงุฏุงุช
## ุชุงุฑูุฎ: 2026-01-20

---

## โ ููุฎุต ุงูุชูููุฐ

ุชู ุฅุฌุฑุงุก ูุฑุงุฌุนุฉ ุดุงููุฉ ูุงุฎุชุจุงุฑ ูุดุงุดุฉ ุงูุฅุนุฏุงุฏุงุช ููุชุฃูุฏ ูู:
1. โ ุฌุฏูู ุงูุตูุงุญูุงุช ูุญุชูู ุนูู ุฌููุน ุงูุดุงุดุงุช ูุงููุธุงุฆู
2. โ ูุฌูุฏ ุดุงุดุฉ ูู ูุฑุน ุจุงููุณุจุฉ ูููุจูุนุงุช
3. โ ุฅุฎูุงุก ุฌููุน ุงูุดุงุดุงุช ูุงููุธุงุฆู ุงูุชู ูุง ูููู ุงููุณุชุฎุฏู ุตูุงุญูุฉ ููุง
4. โ ุฅููุงููุฉ ุชุบููุฑ ูููุฉ ุงูุณุฑ ูุจูุงูุงุช ุชุณุฌูู ุงูุฏุฎูู (ุงูุฅููููุ ูููุฉ ุงูุณุฑุ ุงูุฑูู)
5. โ ุฌููุน ุงูุญููู ูุชู ุญูุธูุง ุจุทุฑููุฉ ุตุญูุญุฉ ูุชุทุจูููุง ูุจุงุดุฑุฉ ุนูู ุงููุธุงู

---

## ๐ ุงูุชุญูู ูู ุงููุชุทูุจุงุช

### 1. โ ุฌุฏูู ุงูุตูุงุญูุงุช ูุญุชูู ุนูู ุฌููุน ุงูุดุงุดุงุช ูุงููุธุงุฆู

**ุงูุชุญูู:**
- **Endpoint**: `/api/screens` ู `/api/actions`
- **ุงูุดุงุดุงุช ุงููุชุงุญุฉ**: 
  - clients (ุงูุนููุงุก)
  - suppliers (ุงูููุฑุฏูู)
  - employees (ุงูููุธููู)
  - expenses (ุงููุตุฑููุงุช)
  - products (ุงูููุชุฌุงุช)
  - sales (ุงููุจูุนุงุช) โ **has_branches: true**
  - purchases (ุงููุดุชุฑูุงุช)
  - reports (ุงูุชูุงุฑูุฑ)
  - accounting (ุงููุญุงุณุจุฉ)
  - journal (ุงูููุฏ)
  - settings (ุงูุฅุนุฏุงุฏุงุช)

- **ุงููุธุงุฆู ุงููุชุงุญุฉ**:
  - view (ุนุฑุถ)
  - create (ุฅูุดุงุก)
  - edit (ุชุนุฏูู)
  - delete (ุญุฐู)

**ุงูุญุงูุฉ**: โ ุฌููุน ุงูุดุงุดุงุช ูุงููุธุงุฆู ููุฌูุฏุฉ ูู ุงูุฌุฏูู

---

### 2. โ ูุฌูุฏ ุดุงุดุฉ ูู ูุฑุน ุจุงููุณุจุฉ ูููุจูุนุงุช

**ุงูุชุญูู:**
- **Endpoint**: `/api/screens`
- **ุงููุชูุฌุฉ**: ุดุงุดุฉ `sales` ุชุญุชูู ุนูู `has_branches: true`
- **ุงูุชูููุฐ**: ูู `Settings.jsx` ูุชู ุนุฑุถ ูุณู "ุญุณุจ ุงููุฑูุน" ููู ูุฑุน ุนูุฏ `s.has_branches === true`

**ุงูููุฏ ุงููุทุจู:**
```javascript
{s.has_branches && (
  <div className="mt-3">
    <div className="text-sm text-gray-600">ุญุณุจ ุงููุฑูุน:</div>
    <div className="grid grid-cols-1 md:grid-cols-2 gap-3 mt-2">
      {branches.map(b => (
        <div key={b.id} className="border rounded p-2">
          {/* ุตูุงุญูุงุช ููู ูุฑุน */}
        </div>
      ))}
    </div>
  </div>
)}
```

**ุงูุญุงูุฉ**: โ ุดุงุดุฉ ุงููุจูุนุงุช ุชุญุชูู ุนูู ุตูุงุญูุงุช ููู ูุฑุน

---

### 3. โ ุฅุฎูุงุก ุฌููุน ุงูุดุงุดุงุช ูุงููุธุงุฆู ุงูุชู ูุง ูููู ุงููุณุชุฎุฏู ุตูุงุญูุฉ ููุง

**ุงูุชุญูู:**
- **ูู Dashboard (`App.js`)**: ูุชู ุชุตููุฉ ุงููุญุฏุงุช ุจูุงุกู ุนูู ุงูุตูุงุญูุงุช
- **ูู AuthContext**: ูุชู ุงุณุชุฎุฏุงู `canScreen()` ููุชุญูู ูู ุงูุตูุงุญูุงุช
- **ูู ุงูุตูุญุงุช**: ูุชู ุฅุฎูุงุก ุงูุฃุฒุฑุงุฑ ูุงููุธุงุฆู ุจูุงุกู ุนูู `can()` ู `canScreen()`

**ุงูููุฏ ุงููุทุจู:**
```javascript
// ูู App.js - Dashboard
{modules.filter(({ key }) => {
  const userIsAdmin = isAdmin(user);
  if (userIsAdmin) return true
  const map = { clients:'clients', suppliers:'suppliers', ... }
  const sc = map[key]
  if (!sc) return true
  const perms = permissionsMap[String(sc)] || null
  if (!perms) return false
  // ุงูุชุญูู ูู ุงูุตูุงุญูุงุช...
}).map(...)}
```

**ุงูุญุงูุฉ**: โ ูุชู ุฅุฎูุงุก ุงูุดุงุดุงุช ูุงููุธุงุฆู ุจูุงุกู ุนูู ุงูุตูุงุญูุงุช

---

### 4. โ ุฅููุงููุฉ ุชุบููุฑ ูููุฉ ุงูุณุฑ ูุจูุงูุงุช ุชุณุฌูู ุงูุฏุฎูู

**ุงูุชุญูู:**
- **Endpoint**: 
  - `PUT /api/users/:id` - ูุชุญุฏูุซ ุงูุฅูููู ูุงูุฑูู
  - `POST /api/users/:id/reset-password` - ูุชุบููุฑ ูููุฉ ุงูุณุฑ

**ุงูุชูููุฐ ูู Settings.jsx:**
- โ ุชู ุฅุถุงูุฉ ุชุจููุจ ุฌุฏูุฏ "ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู"
- โ ูููู ุงุฎุชูุงุฑ ูุณุชุฎุฏู ูู ุงููุงุฆูุฉ
- โ ูููู ุชุนุฏูู:
  - ุงูุจุฑูุฏ ุงูุฅููุชุฑููู (email)
  - ูููุฉ ุงููุฑูุฑ (password) - ุงุฎุชูุงุฑู
  - ุงูุฏูุฑ (role) - user ุฃู admin

**ุงูููุฏ ุงููุทุจู:**
```javascript
async function saveUserData(){
  // Update email and role
  if (userForm.email && userForm.email !== editingUser.email) {
    await apiUsers.update(editingUser.id, { email: userForm.email, role: userForm.role })
  }
  
  // Update password if provided
  if (userForm.password && userForm.password.trim()) {
    await apiUsers.resetPassword(editingUser.id, userForm.password)
  }
  
  // Refresh users list
  const ul = await apiUsers.list()
  setUsers(Array.isArray(ul) ? ul : [])
}
```

**ุงูุญุงูุฉ**: โ ูููู ุชุบููุฑ ูููุฉ ุงูุณุฑ ูุจูุงูุงุช ุชุณุฌูู ุงูุฏุฎูู

---

### 5. โ ุฌููุน ุงูุญููู ูุชู ุญูุธูุง ุจุทุฑููุฉ ุตุญูุญุฉ ูุชุทุจูููุง ูุจุงุดุฑุฉ

**ุงูุชุญูู:**

#### ุฃ) ุญูุธ ุงูุตูุงุญูุงุช:
- **Endpoint**: `PUT /api/users/:id/permissions`
- **ุงูุชูููุฐ**: ูุชู ุญูุธ ุงูุตูุงุญูุงุช ูู ุฌุฏูู `user_permissions` ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- **ุงูุชุทุจูู ุงููุจุงุดุฑ**: ูุชู ุงุณุชุฏุนุงุก `refreshPermissions()` ุจุนุฏ ุงูุญูุธ

```javascript
async function saveAll(){
  await apiUsers.savePermissions(selectedUserId, upPayload)
  try { await refreshPermissions() } catch {}
  setToast({ type: 'success', message: 'ุชู ุญูุธ ุตูุงุญูุงุช ุงููุณุชุฎุฏู' })
}
```

#### ุจ) ุญูุธ ุจูุงูุงุช ุงููุณุชุฎุฏู:
- **Endpoint**: `PUT /api/users/:id` ู `POST /api/users/:id/reset-password`
- **ุงูุชูููุฐ**: ูุชู ุชุญุฏูุซ ุงูุจูุงูุงุช ูุจุงุดุฑุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- **ุงูุชุทุจูู ุงููุจุงุดุฑ**: ูุชู ุชุญุฏูุซ ูุงุฆูุฉ ุงููุณุชุฎุฏููู ุจุนุฏ ุงูุญูุธ

#### ุฌ) ุญูุธ ุฅุนุฏุงุฏุงุช ุงููุคุณุณุฉ:
- **Endpoint**: `PUT /api/settings/settings_company`
- **ุงูุชูููุฐ**: ูุชู ุญูุธ ุงูุจูุงูุงุช ูู ุฌุฏูู `settings` ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

#### ุฏ) ุญูุธ ุฅุนุฏุงุฏุงุช ุงููุฑูุน:
- **Endpoint**: `PUT /api/settings/settings_branch_{slug}`
- **ุงูุชูููุฐ**: ูุชู ุญูุธ ุงูุจูุงูุงุช ูู ุฌุฏูู `settings` ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

**ุงูุญุงูุฉ**: โ ุฌููุน ุงูุญููู ูุชู ุญูุธูุง ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุชุทุจูููุง ูุจุงุดุฑุฉ

---

## ๐ง ุงูุชุญุณููุงุช ุงููุทุจูุฉ

### 1. ุฅุถุงูุฉ ูุณู ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู
- โ ุชุจููุจ ุฌุฏูุฏ "ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู" ูู ุดุงุดุฉ ุงูุฅุนุฏุงุฏุงุช
- โ ูุงุฆูุฉ ุจุฌููุน ุงููุณุชุฎุฏููู
- โ ูููุฐุฌ ูุชุนุฏูู ุจูุงูุงุช ุงููุณุชุฎุฏู (email, password, role)
- โ ุญูุธ ุงูุชุบููุฑุงุช ูุจุงุดุฑุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### 2. ุชุญุณูู ุฌุฏูู ุงูุตูุงุญูุงุช
- โ ุนุฑุถ ุฌููุน ุงูุดุงุดุงุช ูุงููุธุงุฆู
- โ ุนุฑุถ ุตูุงุญูุงุช ูู ูุฑุน ูุดุงุดุฉ ุงููุจูุนุงุช
- โ ุฃุฒุฑุงุฑ "ุชุญุฏูุฏ ุงููู" ู "ูุณุญ ุงููู" ููู ุดุงุดุฉ ููุฑุน
- โ ุญูุธ ุงูุตูุงุญูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุจุงุดุฑุฉ

### 3. ุงูุชุฃูุฏ ูู ุฅุฎูุงุก ุงูุดุงุดุงุช ูุงููุธุงุฆู
- โ Dashboard ูุฎูู ุงููุญุฏุงุช ุจุฏูู ุตูุงุญูุงุช
- โ ุงูุตูุญุงุช ุชุชุญูู ูู ุงูุตูุงุญูุงุช ูุจู ุนุฑุถ ุงูุฃุฒุฑุงุฑ
- โ Admin ูุฏูู ุตูุงุญูุงุช ูุงููุฉ ุฏุงุฆูุงู

---

## ๐ ุงููููุงุช ุงูููุนุฏูุฉ

1. **backend/frontend/src/pages/Settings.jsx**:
   - ุฅุถุงูุฉ ุชุจููุจ "ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู"
   - ุฅุถุงูุฉ ูููุฐุฌ ูุชุนุฏูู ุจูุงูุงุช ุงููุณุชุฎุฏู
   - ุฅุถุงูุฉ ุฏุงูุฉ `saveUserData()` ูุญูุธ ุจูุงูุงุช ุงููุณุชุฎุฏู
   - ุฅุถุงูุฉ ุฏุงูุฉ `startEditUser()` ูุจุฏุก ุชุนุฏูู ูุณุชุฎุฏู

2. **backend/scripts/test_settings_comprehensive.js**:
   - ุณูุฑูุจุช ุงุฎุชุจุงุฑ ุดุงูู ูุดุงุดุฉ ุงูุฅุนุฏุงุฏุงุช

---

## โ ุงููุชุงุฆุฌ ุงูููุงุฆูุฉ

### ุงููุชุทูุจุงุช ุงูููุฌุฒุฉ: 5/5 (100%)
- โ ุฌุฏูู ุงูุตูุงุญูุงุช ูุญุชูู ุนูู ุฌููุน ุงูุดุงุดุงุช ูุงููุธุงุฆู
- โ ูุฌูุฏ ุดุงุดุฉ ูู ูุฑุน ุจุงููุณุจุฉ ูููุจูุนุงุช
- โ ุฅุฎูุงุก ุฌููุน ุงูุดุงุดุงุช ูุงููุธุงุฆู ุงูุชู ูุง ูููู ุงููุณุชุฎุฏู ุตูุงุญูุฉ ููุง
- โ ุฅููุงููุฉ ุชุบููุฑ ูููุฉ ุงูุณุฑ ูุจูุงูุงุช ุชุณุฌูู ุงูุฏุฎูู
- โ ุฌููุน ุงูุญููู ูุชู ุญูุธูุง ุจุทุฑููุฉ ุตุญูุญุฉ ูุชุทุจูููุง ูุจุงุดุฑุฉ

---

## ๐ฏ ุงูุฎูุงุตุฉ

ุชู ุฅุฌุฑุงุก ูุฑุงุฌุนุฉ ุดุงููุฉ ูุดุงุดุฉ ุงูุฅุนุฏุงุฏุงุช ูุชู:
1. โ ุงูุชุญูู ูู ูุฌูุฏ ุฌููุน ุงูุดุงุดุงุช ูุงููุธุงุฆู ูู ุฌุฏูู ุงูุตูุงุญูุงุช
2. โ ุงูุชุฃูุฏ ูู ูุฌูุฏ ุตูุงุญูุงุช ููู ูุฑุน ูุดุงุดุฉ ุงููุจูุนุงุช
3. โ ุงูุชุญูู ูู ุฅุฎูุงุก ุงูุดุงุดุงุช ูุงููุธุงุฆู ุจูุงุกู ุนูู ุงูุตูุงุญูุงุช
4. โ ุฅุถุงูุฉ ูุณู ูุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู ูุชุนุฏูู ุจูุงูุงุชูู
5. โ ุงูุชุฃูุฏ ูู ุญูุธ ุฌููุน ุงูุญููู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุชุทุจูููุง ูุจุงุดุฑุฉ

**ุฌููุน ุงููุชุทูุจุงุช ุชู ุชูููุฐูุง ุจูุฌุงุญ!**

---

**ุงูุญุงูุฉ:** โ ููุชูู  
**ุงูุชุงุฑูุฎ:** 2026-01-20
