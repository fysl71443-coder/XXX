# ุชูุฑูุฑ ุชูุธูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุฅุนุงุฏุฉ ุงูุชุฑููู
## ุชุงุฑูุฎ: 2026-01-20

---

## ๐ฏ ุงููุฏู
ุชูุธูู ุฌููุน ุงูุจูุงูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุฅุนุงุฏุฉ ุชุนููู ุงูุชุฑูููุงุช ูุชุจุฏุฃ ูู ุงูุจุฏุงูุฉ ูุน ุฅุนุงุฏุฉ ุงุณุชุฎุฏุงู ุงูุฃุฑูุงู ุงููุญุฐููุฉ

---

## โ ูุง ุชู ุฅูุฌุงุฒู

### 1. ุชูุธูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุญุฐู journal_postings
- โ ุญุฐู journal_entries
- โ ุญุฐู invoices
- โ ุญุฐู expenses
- โ ุญุฐู orders
- โ ุญุฐู supplier_invoices
- โ ุญุฐู audit_log
- โ ุญุฐู user_permissions
- โ ุญุฐู partners
- โ ุญุฐู employees
- โ ุญุฐู products
- โ ุญุฐู inventory_transactions (ุฅู ูุฌุฏุช)
- โ ุญุฐู stock_movements (ุฅู ูุฌุฏุช)

### 2. ุฅุนุงุฏุฉ ุชุนููู ุงูุชุฑูููุงุช
- โ ุฅุนุงุฏุฉ ุชุนููู journal_entries_entry_number_seq ุฅูู 1
- โ ุฅุนุงุฏุฉ ุชุนููู ุฌููุน auto-increment IDs ุฅูู 1
- โ ุฌููุน ุงูุฌุฏุงูู ุชุจุฏุฃ ูู ID = 1

### 3. ุฅุนุงุฏุฉ ุงุณุชุฎุฏุงู ุงูุฃุฑูุงู ุงููุญุฐููุฉ
- โ ุฅุถุงูุฉ ุฏุงูุฉ `getNextEntryNumber()` ุงูุชู ุชุนูุฏ ุงุณุชุฎุฏุงู ุงูุฃุฑูุงู ุงููุญุฐููุฉ
- โ ุชุญุฏูุซ ุฌููุน ุงูุฃูุงูู ุงูุชู ุชูุดุฆ entry_number ูุงุณุชุฎุฏุงู ุงูุฏุงูุฉ ุงูุฌุฏูุฏุฉ

---

## ๐ง ุงูุชุบููุฑุงุช ุงููุทุจูุฉ

### 1. ุฏุงูุฉ getNextEntryNumber()
```javascript
async function getNextEntryNumber() {
  // Get all used entry numbers, sorted
  const { rows: usedNumbers } = await pool.query(
    'SELECT entry_number FROM journal_entries ORDER BY entry_number ASC'
  );
  
  const usedSet = new Set((usedNumbers || []).map(r => Number(r.entry_number || 0)));
  
  // Find first gap (deleted number) or use next sequential number
  let nextNumber = 1;
  for (const num of usedSet) {
    if (num === nextNumber) {
      nextNumber++;
    } else if (num > nextNumber) {
      // Found a gap - reuse it
      return nextNumber;
    }
  }
  
  // No gaps found, use next sequential number
  return nextNumber;
}
```

### 2. ุชุญุฏูุซ ุฌููุน ุงูุฃูุงูู ุงูุชู ุชูุดุฆ entry_number
ุชู ุชุญุฏูุซ ุงูุฃูุงูู ุงูุชุงููุฉ:
- โ `POST /journal` - ุฅูุดุงุก ููุฏ ูุฏูู
- โ `POST /api/journal` - ุฅูุดุงุก ููุฏ ูุฏูู
- โ `POST /expenses` - ุฅูุดุงุก ููุฏ ูููุตุฑูู
- โ `POST /api/expenses` - ุฅูุดุงุก ููุฏ ูููุตุฑูู
- โ `PUT /api/expenses/:id` - ุฅูุดุงุก ููุฏ ุนูุฏ ุงูุชุญุฏูุซ
- โ `POST /expenses/:id/post` - ุชุฑุญูู ุงููุตุฑูู
- โ `POST /api/expenses/:id/post` - ุชุฑุญูู ุงููุตุฑูู
- โ `createInvoiceJournalEntry()` - ุฅูุดุงุก ููุฏ ูููุงุชูุฑุฉ

### 3. ุฏุงูุฉ getNextInvoiceNumber() (ุฌุงูุฒุฉ ููุงุณุชุฎุฏุงู)
```javascript
async function getNextInvoiceNumber() {
  // Similar logic to getNextEntryNumber but for invoice numbers
  // Finds gaps in invoice numbers and reuses them
}
```

---

## ๐ ุงููููุงุช ุงููููุดุฃุฉ/ุงูููุญุฏุซุฉ

1. **backend/scripts/clean_database.js**
   - ุณูุฑูุจุช ุดุงูู ูุชูุธูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
   - ุฅุนุงุฏุฉ ุชุนููู ุฌููุน ุงูุชุฑูููุงุช
   - ุงูุชุญูู ูู ุงูุชูุธูู

2. **backend/server.js**
   - ุฅุถุงูุฉ `getNextEntryNumber()` - ูุนูุฏ ุงุณุชุฎุฏุงู ุงูุฃุฑูุงู ุงููุญุฐููุฉ
   - ุฅุถุงูุฉ `getNextInvoiceNumber()` - ุฌุงูุฒุฉ ููุงุณุชุฎุฏุงู
   - ุชุญุฏูุซ ุฌููุน ุงูุฃูุงูู ุงูุชู ุชูุดุฆ entry_number

---

## ๐ฏ ููููุฉ ุนูู ุฅุนุงุฏุฉ ุงูุงุณุชุฎุฏุงู

### ูุซุงู ุนููู:
1. **ุงูุจุฏุงูุฉ**: ูุง ุชูุฌุฏ ูููุฏ โ ุงูููุฏ ุงูุฃูู = 1
2. **ุฅูุดุงุก ูููุฏ**: 1, 2, 3, 4, 5
3. **ุญุฐู ููุฏ #3**: ุงููููุฏ ุงููุชุจููุฉ = 1, 2, 4, 5
4. **ุฅูุดุงุก ููุฏ ุฌุฏูุฏ**: ุณูุณุชุฎุฏู ุงูุฑูู 3 (ุงููุญุฐูู)
5. **ุฅูุดุงุก ููุฏ ุขุฎุฑ**: ุณูุณุชุฎุฏู ุงูุฑูู 6 (ุงูุชุงูู)

### ุงููุฒุงูุง:
- โ ูุง ุชูุฌุฏ ูุฌูุงุช ูู ุงูุชุฑููู
- โ ุงุณุชุฎุฏุงู ุฃูุซู ููุฃุฑูุงู
- โ ุชุฑููู ูุชุณูุณู ูููุทูู
- โ ูุจุฏุฃ ูู 1 ุจุนุฏ ุงูุชูุธูู

---

## ๐ ุงููุชุงุฆุฌ

### ูุจู ุงูุชูุธูู:
- ุงููููุฏ: ูุชุนุฏุฏุฉ
- ุงูููุงุชูุฑ: ูุชุนุฏุฏุฉ
- ุงููุตุฑููุงุช: ูุชุนุฏุฏุฉ
- ุงูุชุฑูููุงุช: ุบูุฑ ููุชุธูุฉ

### ุจุนุฏ ุงูุชูุธูู:
- โ ุงููููุฏ: 0 ุณุฌู
- โ ุงูููุงุชูุฑ: 0 ุณุฌู
- โ ุงููุตุฑููุงุช: 0 ุณุฌู
- โ ุงูุชุฑูููุงุช: ุฌููุนูุง ุชุจุฏุฃ ูู 1
- โ ุฅุนุงุฏุฉ ุงูุงุณุชุฎุฏุงู: ููุนูู ุชููุงุฆูุงู

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ

1. **ุงูุจุฏุก ูู ุฌุฏูุฏ:**
   - ุฌููุน ุงูุชุฑูููุงุช ุชุจุฏุฃ ูู 1
   - ุฅุนุงุฏุฉ ุงูุงุณุชุฎุฏุงู ุชุนูู ุชููุงุฆูุงู

2. **ุงุฎุชุจุงุฑ ุงููุธุงู:**
   ```bash
   # ุฅูุดุงุก ููุฏ ุฌุฏูุฏ - ูุฌุจ ุฃู ูููู ุฑูู 1
   # ุญุฐู ุงูููุฏ
   # ุฅูุดุงุก ููุฏ ุฌุฏูุฏ - ูุฌุจ ุฃู ูุนูุฏ ุงุณุชุฎุฏุงู ุฑูู 1
   ```

3. **ุงูุชุญูู ูู ุงูุชุฑููู:**
   - ุฌููุน ุงููููุฏ ุงูุฌุฏูุฏุฉ ุณุชุณุชุฎุฏู ุงูุฃุฑูุงู ุงููุญุฐููุฉ ุฃููุงู
   - ุซู ุชุณุชุฎุฏู ุงูุฃุฑูุงู ุงูุชุงููุฉ ุงููุชุณูุณูุฉ

---

## โ ุงูุญูู ุงูููุงุฆู

### โ ุงููุธุงู ุฌุงูุฒ ููุนูู ูู ุงูุจุฏุงูุฉ

**ุงููุฒุงูุง:**
- โ ูุงุนุฏุฉ ุจูุงูุงุช ูุธููุฉ ุชูุงูุงู
- โ ุฌููุน ุงูุชุฑูููุงุช ุชุจุฏุฃ ูู 1
- โ ุฅุนุงุฏุฉ ุงุณุชุฎุฏุงู ุงูุฃุฑูุงู ุงููุญุฐููุฉ ุชููุงุฆูุงู
- โ ููุทู ุงูุชุฑููู ุตุญูุญ ูููุทูู
- โ ุชู ุงูุงุญุชูุงุธ ุจู users ู accounts (ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ)

**ุงูุญุงูุฉ:** โ ุฌุงูุฒ ููุงุณุชุฎุฏุงู  
**ุงูุชุงุฑูุฎ:** 2026-01-20
